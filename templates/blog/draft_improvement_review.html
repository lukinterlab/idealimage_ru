{% extends 'base_tailwind.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-4xl font-heading font-bold text-gray-900 dark:text-white mb-2">
                    ‚ú® AI-—É–ª—É—á—à–µ–Ω–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞
                </h1>
                <p class="text-gray-600 dark:text-gray-400">
                    –°—Ç–∞—Ç—å—è: <strong>{{ post.title }}</strong>
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-500 mt-1">
                    –°—Ç–∏–ª—å —É–ª—É—á—à–µ–Ω–∏—è: 
                    {% if improvement_style == 'literary' %}‚úçÔ∏è –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π
                    {% elif improvement_style == 'seo' %}üîç SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
                    {% elif improvement_style == 'emotional' %}üíñ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π
                    {% else %}‚öñÔ∏è –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π{% endif %}
                </p>
            </div>
            <a href="{% url 'blog:post_update' post.slug %}" 
               class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg transition-colors">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É
            </a>
        </div>
    </div>

    <!-- AI –ó–∞–º–µ—á–∞–Ω–∏—è -->
    {% if improvements_notes %}
    <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-2xl p-6 mb-6 border-2 border-purple-200 dark:border-purple-800">
        <div class="flex items-start">
            <div class="bg-purple-500 rounded-full p-3 mr-4">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
            </div>
            <div class="flex-1">
                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">
                    ü§ñ –ß—Ç–æ —É–ª—É—á—à–∏–ª AI:
                </h3>
                <div class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300">
                    {{ improvements_notes|linebreaks }}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <form method="post" action="{% url 'blog:accept_ai_improvements' post.id %}">
            {% csrf_token %}
            <button type="submit" 
                    class="w-full px-6 py-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                ‚úÖ –ü—Ä–∏–Ω—è—Ç—å —É–ª—É—á—à–µ–Ω–∏—è
            </button>
        </form>
        
        <button type="button" 
                onclick="document.getElementById('retryModal').classList.remove('hidden')"
                class="w-full px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center">
            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            üîÑ –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –µ—â—ë —Ä–∞–∑
        </button>
        
        <form method="post" action="{% url 'blog:reject_ai_improvements' post.id %}">
            {% csrf_token %}
            <button type="submit" 
                    class="w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                ‚ùå –û—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π
            </button>
        </form>
    </div>
    
    <!-- Retry Modal -->
    <div id="retryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                        <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è
                    </h3>
                    <button type="button" 
                            onclick="document.getElementById('retryModal').classList.add('hidden')"
                            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form method="post" action="{% url 'blog:retry_ai_improvements' post.id %}" class="space-y-4">
                    {% csrf_token %}
                    
                    <!-- –°—Ç–∏–ª—å -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                            –°—Ç–∏–ª—å —É–ª—É—á—à–µ–Ω–∏—è
                        </label>
                        <select name="style" class="w-full px-4 py-2 border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="balanced" {% if improvement_style == 'balanced' %}selected{% endif %} class="bg-white text-gray-900 dark:bg-gray-800 dark:text-white">‚öñÔ∏è –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                            <option value="literary" {% if improvement_style == 'literary' %}selected{% endif %} class="bg-white text-gray-900 dark:bg-gray-800 dark:text-white">‚úçÔ∏è –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π</option>
                            <option value="seo" {% if improvement_style == 'seo' %}selected{% endif %} class="bg-white text-gray-900 dark:bg-gray-800 dark:text-white">üîç SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                            <option value="emotional" {% if improvement_style == 'emotional' %}selected{% endif %} class="bg-white text-gray-900 dark:bg-gray-800 dark:text-white">üíñ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π</option>
                        </select>
                    </div>
                    
                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                            –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        </label>
                        <textarea name="custom_prompt" 
                                  rows="3"
                                  class="w-full px-4 py-2 border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:border-blue-500 focus:outline-none"
                                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –∫–æ—Ä–æ—á–µ, –¥–æ–±–∞–≤—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤..."></textarea>
                    </div>
                    
                    <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class="p-4 bg-pink-50 dark:bg-pink-900/20 rounded-lg border-2 border-pink-200 dark:border-pink-800">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" name="generate_image" class="w-5 h-5 text-blue-500">
                            <span class="font-semibold text-gray-900 dark:text-white">
                                üé® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            </span>
                        </label>
                        
                        <div class="mt-3 ml-8">
                            <textarea name="image_prompt" 
                                      rows="2"
                                      class="w-full px-4 py-2 border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                                      placeholder="–û–ø–∏—à–∏—Ç–µ —Å—é–∂–µ—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è)"></textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" 
                                class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold rounded-lg transition-all">
                            üîÑ –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å
                        </button>
                        <button type="button" 
                                onclick="document.getElementById('retryModal').classList.add('hidden')"
                                class="px-6 py-3 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold rounded-lg transition-all">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Side-by-side comparison -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- –û—Ä–∏–≥–∏–Ω–∞–ª -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
            <div class="flex items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700">
                <div class="bg-gray-500 rounded-full p-2 mr-3">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                        –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
                    </h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        –í–∞—à —á–µ—Ä–Ω–æ–≤–∏–∫ ({{ original_content|length }} —Å–∏–º–≤–æ–ª–æ–≤)
                    </p>
                </div>
            </div>
            
            <div class="prose dark:prose-invert max-w-none bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 max-h-[600px] overflow-y-auto">
                {{ original_content|safe }}
            </div>
        </div>

        <!-- –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 ring-2 ring-green-500">
            <div class="flex items-center mb-4 pb-4 border-b border-green-200 dark:border-green-700">
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-full p-2 mr-3">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                    </svg>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                        ‚ú® –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è AI
                    </h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è ({{ improved_content|length }} —Å–∏–º–≤–æ–ª–æ–≤)
                    </p>
                </div>
            </div>
            
            <div class="prose dark:prose-invert max-w-none bg-green-50 dark:bg-green-900/10 rounded-lg p-4 max-h-[600px] overflow-y-auto">
                {{ improved_content|safe }}
            </div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6">
        <div class="flex items-start">
            <svg class="w-6 h-6 text-blue-500 mr-3 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="text-blue-800 dark:text-blue-300">
                <p class="font-semibold mb-2">üí° –°–æ–≤–µ—Ç:</p>
                <ul class="space-y-1 text-sm">
                    <li>‚Ä¢ –ü–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è —É–ª—É—á—à–µ–Ω–∏–π –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é</li>
                    <li>‚Ä¢ AI —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–∞—à –∞–≤—Ç–æ—Ä—Å–∫–∏–π —Å—Ç–∏–ª—å –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å</li>
                    <li>‚Ä¢ –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å –¥—Ä—É–≥–∏–º —Å—Ç–∏–ª–µ–º</li>
                    <li>‚Ä¢ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Mobile Warning -->
    <div class="lg:hidden mt-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4">
        <p class="text-yellow-800 dark:text-yellow-300 text-sm">
            üì± –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º —ç–∫—Ä–∞–Ω–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. –î–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä.
        </p>
    </div>
</div>

<style>
.prose h2 {
    font-size: 1.5em;
    font-weight: bold;
    margin-top: 1em;
    margin-bottom: 0.5em;
    color: #1f2937;
}

.dark .prose h2 {
    color: #f9fafb;
}

.prose h3 {
    font-size: 1.25em;
    font-weight: 600;
    margin-top: 0.8em;
    margin-bottom: 0.4em;
    color: #374151;
}

.dark .prose h3 {
    color: #e5e7eb;
}

.prose p {
    margin-bottom: 1em;
    line-height: 1.6;
}

.prose ul, .prose ol {
    margin: 1em 0;
    padding-left: 1.5em;
}

.prose li {
    margin-bottom: 0.5em;
}

.prose strong {
    font-weight: 600;
    color: #111827;
}

.dark .prose strong {
    color: #f9fafb;
}

.prose blockquote {
    border-left: 4px solid #ec4899;
    padding-left: 1em;
    margin: 1em 0;
    font-style: italic;
    color: #6b7280;
}

.dark .prose blockquote {
    border-left-color: #f472b6;
    color: #9ca3af;
}
</style>
{% endblock %}

