{% extends 'base_tailwind.html' %} 
{% load static %}

{% block extra_head %}
{{ form.media.css }}
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8 fade-in">
        <h1 class="text-4xl font-heading font-bold text-gray-900 dark:text-white mb-4">
            –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏
        </h1>
        <p class="text-gray-600 dark:text-gray-400">
            {{ post.title }}
        </p>
    </div>

    <!-- Current Image/Video Preview -->
    {% if post.video_url or post.kartinka %}
    <div class="mb-8 fade-in">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 px-6 py-4">
                <h2 class="text-xl font-heading font-bold text-white flex items-center gap-2">
                    {% if post.video_url %}
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    –¢–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ —Å—Ç–∞—Ç—å–∏
                    {% else %}
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    –¢–µ–∫—É—â–µ–µ –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/–≤–∏–¥–µ–æ —Å—Ç–∞—Ç—å–∏
                    {% endif %}
                </h2>
            </div>
            <div class="relative w-full" style="height: 400px;">
                {% if post.video_url %}
                    {# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤–∏–¥–µ–æ-—Å—Å—ã–ª–∫–∞ #}
                    {% with post.video_url|default:''|lower as video_url_lower %}
                    <div class="w-full h-full bg-black">
                        <iframe src="{{ post.video_url }}" 
                                class="{% if 'shorts' in video_url_lower or 'reel' in video_url_lower or 'stories' in video_url_lower %}h-full w-auto max-w-full mx-auto{% else %}w-full h-full{% endif %}"
                                frameborder="0" 
                                allow="autoplay; encrypted-media; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    {% endwith %}
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                        <p class="text-white text-sm font-medium">
                            üé• {{ post.video_url }}
                        </p>
                    </div>
                {% elif post.kartinka.name|slice:"-4:" == ".mp4" or post.kartinka.name|slice:"-5:" == ".webm" or post.kartinka.name|slice:"-4:" == ".mov" %}
                    {# –í–∏–¥–µ–æ-—Ñ–∞–π–ª #}
                    <video src="{{ post.kartinka.url }}" 
                           class="w-full h-full object-cover"
                           controls
                           preload="metadata">
                        <source src="{{ post.kartinka.url }}" type="video/{% if post.kartinka.name|slice:'-4:' == '.mp4' %}mp4{% elif post.kartinka.name|slice:'-5:' == '.webm' %}webm{% else %}quicktime{% endif %}">
                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ.
                    </video>
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                        <p class="text-white text-sm font-medium">
                            üé• {{ post.kartinka.name }}
                        </p>
                    </div>
                {% else %}
                    {# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ #}
                    <img src="{{ post.kartinka.url }}" 
                         alt="{{ post.title }}" 
                         class="w-full h-full object-cover">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                        <p class="text-white text-sm font-medium">
                            üìÅ {{ post.kartinka.name }}
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="mb-8 fade-in">
        <div class="bg-yellow-50 dark:bg-gray-800 border-2 border-yellow-400 dark:border-yellow-600 rounded-2xl p-6">
            <div class="flex items-start gap-4">
                <svg class="w-8 h-8 text-yellow-600 dark:text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <div>
                    <h3 class="text-lg font-bold text-yellow-800 dark:text-yellow-400 mb-2">
                        ‚ö†Ô∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
                    </h3>
                    <p class="text-yellow-700 dark:text-yellow-300 text-sm">
                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –≤ —Ñ–æ—Ä–º–µ –Ω–∏–∂–µ. –ë–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—å—è –Ω–µ –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞.
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- AI Improvement Ready Notice -->
    {% if ai_improvement_ready %}
    <div class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-2xl p-6 mb-8 border-2 border-green-500 dark:border-green-700 fade-in">
        <div class="flex items-start justify-between">
            <div class="flex items-start gap-4">
                <div class="bg-green-500 rounded-full p-3">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                    </svg>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                        ‚ú® AI-—É–ª—É—á—à–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã!
                    </h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∑–∞–≤–µ—Ä—à–∏–ª —É–ª—É—á—à–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é –≤–µ—Ä—Å–∏—é.
                    </p>
                    <a href="{% url 'blog:draft_improvement_review' post.id %}" 
                       class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold rounded-lg transition-all shadow-lg hover:shadow-xl">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å AI-—É–ª—É—á—à–µ–Ω–∏—è
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% elif ai_improvement_in_progress %}
    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-2xl p-6 mb-8 border-2 border-blue-500 dark:border-blue-700 fade-in">
        <div class="flex items-start gap-4">
            <div class="bg-blue-500 rounded-full p-3 animate-pulse">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
            </div>
            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
                    ü§ñ AI —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º...
                </h3>
                <p class="text-gray-700 dark:text-gray-300">
                    –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ. –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ —É–ª—É—á—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ.
                </p>
            </div>
        </div>
    </div>
    {% elif ai_improvement_status_stale %}
    <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-2xl p-6 mb-8 border-2 border-yellow-400 dark:border-yellow-600 fade-in">
        <div class="flex items-start gap-4">
            <div class="bg-yellow-500 rounded-full p-3">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M4.293 6.293a1 1 0 011.414 0L12 12.586l6.293-6.293a1 1 0 111.414 1.414L13.414 14l6.293 6.293a1 1 0 01-1.414 1.414L12 15.414l-6.293 6.293a1 1 0 01-1.414-1.414L10.586 14 4.293 7.707a1 1 0 010-1.414z"></path>
                </svg>
            </div>
            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
                    ü§ñ AI –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                </h3>
                <p class="text-gray-700 dark:text-gray-300">
                    –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å AI –µ—â—ë —Ä–∞–∑ –ø–æ–∑–∂–µ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é.
                </p>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Generated Image Ready Notice -->
    {% if generated_image %}
    <div class="bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-8 border-2 border-pink-500 dark:border-pink-700 fade-in">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <svg class="w-8 h-8 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            üé® –ù–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- –°—Ç–∞—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
            {% if generated_image.old_image %}
            <div>
                <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</h4>
                <img src="/media/{{ generated_image.old_image }}" alt="–°—Ç–∞—Ä–æ–µ" class="w-full rounded-lg shadow-lg border-2 border-gray-300 dark:border-gray-600">
            </div>
            {% endif %}
            
            <!-- –ù–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
            <div>
                <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ AI:</h4>
                <img src="/media/{{ generated_image.new_image }}" alt="–ù–æ–≤–æ–µ" class="w-full rounded-lg shadow-lg border-4 border-pink-500">
            </div>
        </div>
        
        <div class="flex gap-3">
            <form method="post" action="{% url 'blog:apply_generated_image' post.id %}" class="flex-1">
                {% csrf_token %}
                <input type="hidden" name="image_path" value="{{ generated_image.new_image }}">
                <button type="submit" class="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold rounded-lg transition-all shadow-lg">
                    ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                </button>
            </form>
            
            <form method="post" action="{% url 'blog:reject_generated_image' post.id %}">
                {% csrf_token %}
                <input type="hidden" name="image_path" value="{{ generated_image.new_image }}">
                <button type="submit" class="px-6 py-3 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold rounded-lg transition-all">
                    ‚ùå –û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ
                </button>
            </form>
        </div>
    </div>
    {% endif %}
    
    <!-- Form Card -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 fade-in">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            {% if ai_disabled %}
            <div class="rounded-xl border border-yellow-400 bg-yellow-50 dark:bg-yellow-900/30 dark:border-yellow-600 p-4 flex gap-3 items-start">
                <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M5.07 19h13.86c1.54 0 2.5-1.66 1.73-3L13.73 5c-.77-1.33-2.69-1.33-3.46 0L3.34 16c-.77 1.34.19 3 1.73 3z"></path>
                </svg>
                <div>
                    <p class="text-sm font-semibold text-yellow-800 dark:text-yellow-200">
                        AI-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ–π—á–∞—Å –æ—Ç–∫–ª—é—á–µ–Ω–∞. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ AI –ø–æ–∑–∂–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
                    </p>
                </div>
            </div>
            {% endif %}
            
            <!-- Custom Form Styles for Dark Mode -->
            <style>
                .dark form input[type="text"],
                .dark form input[type="email"],
                .dark form input[type="url"],
                .dark form input[type="number"],
                .dark form textarea,
                .dark form select {
                    background-color: #1f2937;
                    border-color: #374151;
                    color: #f9fafb;
                }
                
                .dark form input[type="text"]:focus,
                .dark form input[type="email"]:focus,
                .dark form input[type="url"]:focus,
                .dark form input[type="number"]:focus,
                .dark form textarea:focus,
                .dark form select:focus {
                    border-color: #ec4899;
                    box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
                }
                
                .dark form label {
                    color: #f9fafb;
                }
                
                .dark form .helptext {
                    color: #9ca3af;
                }
                
                form input[type="text"],
                form input[type="email"],
                form input[type="url"],
                form input[type="number"],
                form textarea,
                form select {
                    width: 100%;
                    padding: 0.75rem 1rem;
                    border: 2px solid #e5e7eb;
                    border-radius: 0.5rem;
                    font-size: 1rem;
                    transition: all 0.2s;
                    margin-top: 0.5rem;
                }
                
                form input[type="text"]:focus,
                form input[type="email"]:focus,
                form input[type="url"]:focus,
                form input[type="number"]:focus,
                form textarea:focus,
                form select:focus {
                    outline: none;
                    border-color: #ec4899;
                    box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
                }
                
                form label {
                    display: block;
                    font-weight: 600;
                    color: #374151;
                    margin-bottom: 0.25rem;
                }
                
                form p {
                    margin-bottom: 1.5rem;
                }
                
                form .helptext {
                    display: block;
                    font-size: 0.875rem;
                    color: #6b7280;
                    margin-top: 0.25rem;
                }
                
                form textarea {
                    min-height: 150px;
                }
                
                form input[type="file"] {
                    display: block;
                    width: 100%;
                    padding: 0.75rem;
                    margin-top: 0.5rem;
                    border: 2px dashed #e5e7eb;
                    border-radius: 0.5rem;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                
                form input[type="file"]:hover {
                    border-color: #ec4899;
                    background-color: #fdf2f8;
                }
                
                .dark form input[type="file"] {
                    border-color: #374151;
                    background-color: #1f2937;
                    color: #f9fafb;
                }
                
                .dark form input[type="file"]:hover {
                    border-color: #ec4899;
                    background-color: #374151;
                }
                
                /* –°–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π textarea –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CKEditor */
                textarea#id_content[data-processed="1"] {
                    position: absolute !important;
                    left: -9999px !important;
                    width: 1px !important;
                    height: 1px !important;
                    opacity: 0 !important;
                    visibility: hidden !important;
                    pointer-events: none !important;
                }
            </style>
            
            <div class="text-gray-900 dark:text-white">
                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã -->
                
                <!-- –ü–æ–ª–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç) - –≤—ã–≤–æ–¥–∏–º —è–≤–Ω–æ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å -->
                <div class="mb-6" id="content-field-wrapper" style="display: block !important; visibility: visible !important;">
                    <label for="id_content" class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                        –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                    </label>
                    <div id="content-widget-wrapper" style="display: block !important; visibility: visible !important;">
                        {{ form.content }}
                    </div>
                    {% if form.content.help_text %}
                        <span class="helptext block mt-1 text-sm text-gray-600 dark:text-gray-400">{{ form.content.help_text }}</span>
                    {% endif %}
                    {% if form.content.errors %}
                        <span class="text-red-500 text-sm block mt-1">{{ form.content.errors }}</span>
                    {% endif %}
                </div>
                
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã -->
                {% for field in form %}
                    {% if field.name not in 'content,use_ai_assistant,ai_improvement_style,ai_custom_prompt,generate_image,image_generation_prompt' %}
                        <p>
                            {{ field.label_tag }}
                            {{ field }}
                            {% if field.help_text %}
                                <span class="helptext">{{ field.help_text }}</span>
                            {% endif %}
                            {% if field.errors %}
                                <span class="text-red-500 text-sm">{{ field.errors }}</span>
                            {% endif %}
                        </p>
                    {% endif %}
                {% endfor %}
            </div>
            
            <!-- AI-–ø–æ–º–æ—â–Ω–∏–∫ –±–ª–æ–∫ -->
            <div class="mt-8 p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-800 rounded-xl border-2 border-purple-200 dark:border-purple-900">
                <div class="flex items-start gap-3 mb-4">
                    <div class="p-2 bg-purple-500 rounded-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
                            ü§ñ AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
                        </h3>
                        <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
                            –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ AI-–ø–æ–º–æ—â–Ω–∏–∫–∞, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –≤–∞—à —á–µ—Ä–Ω–æ–≤–∏–∫. –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —É–ª—É—á—à–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—è—è –≤–∞—à –∞–≤—Ç–æ—Ä—Å–∫–∏–π —Å—Ç–∏–ª—å.
                        </p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <!-- –ß–µ–∫–±–æ–∫—Å AI -->
                    <div class="flex items-center gap-3 p-4 bg-white dark:bg-gray-800 rounded-lg">
                        {{ form.use_ai_assistant }}
                        <label for="{{ form.use_ai_assistant.id_for_label }}" class="text-base font-medium text-gray-900 dark:text-white cursor-pointer">
                            {{ form.use_ai_assistant.label }}
                        </label>
                    </div>
                    
                    <!-- –°—Ç–∏–ª—å —É–ª—É—á—à–µ–Ω–∏—è -->
                    <div class="p-4 bg-white dark:bg-gray-800 rounded-lg {% if not form.use_ai_assistant.value %}hidden{% endif %}" data-ai-settings>
                        <label for="{{ form.ai_improvement_style.id_for_label }}" class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                            {{ form.ai_improvement_style.label }}
                        </label>
                        {{ form.ai_improvement_style }}
                        
                        <!-- –û–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∏–ª–µ–π -->
                        <div class="mt-4 space-y-2 text-sm text-gray-600 dark:text-gray-400">
                            <p>‚öñÔ∏è <strong>–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π:</strong> –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ç–∞—Ç–µ–π</p>
                            <p>‚úçÔ∏è <strong>–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π:</strong> –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫, –æ–±—Ä–∞–∑–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</p>
                            <p>üîç <strong>SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π:</strong> –° –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º</p>
                            <p>üíñ <strong>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π:</strong> –í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</p>
                        </div>
                        
                        {% if form.ai_improvement_style.help_text %}
                            <span class="helptext mt-2 block">{{ form.ai_improvement_style.help_text }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è AI -->
                    <div class="p-4 bg-white dark:bg-gray-800 rounded-lg {% if not form.use_ai_assistant.value %}hidden{% endif %}" data-ai-settings>
                        <label for="{{ form.ai_custom_prompt.id_for_label }}" class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                            üìù {{ form.ai_custom_prompt.label }}
                        </label>
                        {{ form.ai_custom_prompt }}
                        {% if form.ai_custom_prompt.help_text %}
                            <span class="helptext mt-2 block">{{ form.ai_custom_prompt.help_text }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class="p-4 bg-white dark:bg-gray-800 rounded-lg border-2 border-pink-200 dark:border-pink-900">
                        <div class="flex items-center gap-3 mb-4">
                            {{ form.generate_image }}
                            <label for="{{ form.generate_image.id_for_label }}" class="text-base font-medium text-gray-900 dark:text-white cursor-pointer">
                                {{ form.generate_image.label }}
                            </label>
                        </div>
                        
                        <div class="pl-7 {% if not form.generate_image.value %}hidden{% endif %}" data-ai-image-settings>
                            <label for="{{ form.image_generation_prompt.id_for_label }}" class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                                {{ form.image_generation_prompt.label }}
                            </label>
                            {{ form.image_generation_prompt }}
                            {% if form.image_generation_prompt.help_text %}
                                <span class="helptext mt-1 block">{{ form.image_generation_prompt.help_text }}</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                        <div class="flex items-start gap-2">
                            <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            <div class="text-sm text-blue-800 dark:text-blue-300">
                                <strong>–í–∞–∂–Ω–æ:</strong> AI-–ø–æ–º–æ—â–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–ß–µ—Ä–Ω–æ–≤–∏–∫". –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —Å–º–æ–∂–µ—Ç–µ –ø—Ä–∏–Ω—è—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-4 pt-6 border-t dark:border-gray-700">
                <button type="submit" class="flex-1 bg-gradient-to-r from-primary to-secondary text-white font-semibold px-8 py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                    <svg class="inline-block w-5 h-5 mr-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                    </svg>
                    –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é
                </button>
                <a href="{{ post.get_absolute_url }}" class="px-8 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                    –û—Ç–º–µ–Ω–∞
                </a>
            </div>
        </form>
    </div>

    <!-- Telegram Publishing Section -->
    {% if not post.fixed %}
    <div class="mt-8 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-2xl p-8 fade-in">
        <h2 class="text-2xl font-heading font-bold text-gray-900 dark:text-white mb-6">
            üì± –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Telegram
        </h2>
        <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% csrf_token %}
            <button type="submit" name="publish_telegram_1" class="bg-white dark:bg-gray-800 hover:bg-primary dark:hover:bg-primary hover:text-white dark:text-white text-gray-900 font-semibold px-6 py-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary transition-all shadow-sm hover:shadow-md">
                ü´£ –ü–û –°–ï–ö–†–ï–¢–£ ü§´
            </button>
            <button type="submit" name="publish-telegram-2" class="bg-white dark:bg-gray-800 hover:bg-primary dark:hover:bg-primary hover:text-white dark:text-white text-gray-900 font-semibold px-6 py-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary transition-all shadow-sm hover:shadow-md">
                üîÆ LukInterLab üîÆ
            </button>
            <button type="submit" name="publish-telegram-3" class="bg-white dark:bg-gray-800 hover:bg-primary dark:hover:bg-primary hover:text-white dark:text-white text-gray-900 font-semibold px-6 py-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary transition-all shadow-sm hover:shadow-md">
                üíÉ –∏–¥–µ–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ üíÉ
            </button>
            <button type="submit" name="publish-telegram-4" class="bg-white dark:bg-gray-800 hover:bg-primary dark:hover:bg-primary hover:text-white dark:text-white text-gray-900 font-semibold px-6 py-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary transition-all shadow-sm hover:shadow-md">
                üë© —à–∏–∫–∞—Ä–Ω–∞—è –ø—Ä–∏—á—ë—Å–∫–∞ üë©
            </button>
            <button type="submit" name="publish-telegram-5" class="bg-white dark:bg-gray-800 hover:bg-primary dark:hover:bg-primary hover:text-white dark:text-white text-gray-900 font-semibold px-6 py-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary transition-all shadow-sm hover:shadow-md">
                üéÄ –¥–µ–≤–æ—á–∫–∏ –∫–æ—Å–∏—á–∫–∏ üéÄ
            </button>
            <button type="submit" name="publish-telegram-6" class="bg-white dark:bg-gray-800 hover:bg-primary dark:hover:bg-primary hover:text-white dark:text-white text-gray-900 font-semibold px-6 py-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary transition-all shadow-sm hover:shadow-md">
                üëóüë† fashion couture üë†üëó
            </button>
        </form>
    </div>
    {% else %}
    <div class="mt-8 bg-yellow-50 dark:bg-gray-800 border-l-4 border-yellow-400 dark:border-yellow-600 p-6 rounded-lg fade-in">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-yellow-400 dark:text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700 dark:text-yellow-400">
                    –í—ã —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º –ø–æ—Å—Ç–µ –≤ Telegram.<br>
                    –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ —Ä–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º –±–ª–æ–≥–µ, —Ç–æ —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –¢–ì" –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø–æ—Å—Ç. 
                    –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª–µ".
                </p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–æ–ª–µ content –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–æ
        const contentWrapper = document.getElementById('content-field-wrapper');
        const contentWidget = document.getElementById('content-widget-wrapper');
        const contentField = document.getElementById('id_content');
        
        if (contentWrapper) {
            contentWrapper.style.display = 'block';
            contentWrapper.style.visibility = 'visible';
        }
        if (contentWidget) {
            contentWidget.style.display = 'block';
            contentWidget.style.visibility = 'visible';
        }
        if (contentField) {
            contentField.style.display = 'block';
            contentField.style.visibility = 'visible';
        }
        
        const aiCheckbox = document.getElementById('id_use_ai_assistant');
        const aiSections = document.querySelectorAll('[data-ai-settings]');
        const imageCheckbox = document.getElementById('id_generate_image');
        const imageSections = document.querySelectorAll('[data-ai-image-settings]');

        const toggleSections = (checked, sections) => {
            sections.forEach((section) => {
                section.classList.toggle('hidden', !checked);
                section.setAttribute('aria-hidden', String(!checked));
            });
        };

        if (aiCheckbox) {
            toggleSections(aiCheckbox.checked, aiSections);
            aiCheckbox.addEventListener('change', (event) => {
                toggleSections(event.target.checked, aiSections);
            });
        }

        if (imageCheckbox) {
            toggleSections(imageCheckbox.checked, imageSections);
            imageCheckbox.addEventListener('change', (event) => {
                toggleSections(event.target.checked, imageSections);
            });
        }
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª—è content (–Ω–∞ —Å–ª—É—á–∞–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫)
        setInterval(function() {
            if (contentWrapper && contentWrapper.style.display === 'none') {
                contentWrapper.style.display = 'block';
                contentWrapper.style.visibility = 'visible';
            }
            if (contentWidget && contentWidget.style.display === 'none') {
                contentWidget.style.display = 'block';
                contentWidget.style.visibility = 'visible';
            }
            if (contentField && contentField.style.display === 'none') {
                contentField.style.display = 'block';
                contentField.style.visibility = 'visible';
            }
        }, 1000);
    });
</script>
{% endblock %}

{% block extra_scripts %}
{{ form.media.js }}
<script>
    // –°–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π textarea –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CKEditor
    (function() {
        function hideOriginalTextarea() {
            var textarea = document.getElementById('id_content');
            if (textarea && CKEDITOR.instances['id_content']) {
                // CKEditor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, —Å–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π textarea
                textarea.style.position = 'absolute';
                textarea.style.left = '-9999px';
                textarea.style.width = '1px';
                textarea.style.height = '1px';
                textarea.style.opacity = '0';
                textarea.style.visibility = 'hidden';
                console.log('–ò—Å—Ö–æ–¥–Ω—ã–π textarea —Å–∫—Ä—ã—Ç');
            }
        }
        
        function initCKEditor() {
            if (typeof CKEDITOR === 'undefined') {
                // –ï—Å–ª–∏ CKEditor –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º –µ—â–µ
                setTimeout(initCKEditor, 100);
                return;
            }
            
            var textarea = document.getElementById('id_content');
            var widget = document.querySelector('.django-ckeditor-widget[data-field-id="id_content"]');
            
            if (textarea) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ
                if (!CKEDITOR.instances['id_content']) {
                    try {
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º CKEditor
                        var editor = CKEDITOR.replace('id_content');
                        console.log('CKEditor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è id_content', editor);
                        
                        // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å–∫—Ä—ã–≤–∞–µ–º textarea
                        editor.on('instanceReady', function() {
                            hideOriginalTextarea();
                        });
                        
                        // –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ
                        setTimeout(hideOriginalTextarea, 500);
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CKEditor:', e);
                    }
                } else {
                    // –£–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º textarea
                    hideOriginalTextarea();
                }
            }
        }
        
        // –ü—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initCKEditor, 500);
            });
        } else {
            setTimeout(initCKEditor, 500);
        }
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ window.onload
        window.addEventListener('load', function() {
            setTimeout(function() {
                initCKEditor();
                hideOriginalTextarea();
            }, 300);
        });
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–∫—Ä—ã–≤–∞–µ–º textarea –µ—Å–ª–∏ CKEditor —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
        setInterval(function() {
            if (CKEDITOR.instances['id_content']) {
                hideOriginalTextarea();
            }
        }, 1000);
    })();
</script>
{% endblock %}