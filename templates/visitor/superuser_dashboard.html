{% extends 'base_tailwind.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-900">
    <div class="max-w-full mx-auto">
        <!-- Header -->
        <div class="mb-8 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
            <div class="flex-1">
                <h1 class="text-3xl lg:text-4xl font-heading font-bold text-gray-900 dark:text-white mb-2">
                    ‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                </h1>
                <p class="text-gray-600 dark:text-gray-400">
                    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–æ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                </p>
            </div>

    

        </div>

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ total_users }}</p>
                    </div>
                    <div class="bg-blue-100 dark:bg-blue-900/30 rounded-full p-3">
                        <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">–°—Ç–∞—Ç–µ–π</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ total_posts }}</p>
                    </div>
                    <div class="bg-green-100 dark:bg-green-900/30 rounded-full p-3">
                        <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ total_comments }}</p>
                    </div>
                    <div class="bg-purple-100 dark:bg-purple-900/30 rounded-full p-3">
                        <svg class="w-8 h-8 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">–î–æ–Ω–∞—Ç–æ–≤</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ total_donations }}‚ÇΩ</p>
                    </div>
                    <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-full p-3">
                        <svg class="w-8 h-8 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç -->
        <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 rounded-2xl shadow-2xl p-8 mb-8">
            <div class="text-white">
                <h2 class="text-3xl font-bold mb-2 flex items-center">
                    <span class="mr-3">ü§ñ</span>
                    AI-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
                </h2>
                <p class="text-white/90 mb-6">–£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–æ–º</p>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ AI -->
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4">
                        <div class="text-sm text-white/70 mb-1">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å—Ç–∞—Ç–µ–π</div>
                        <div class="text-2xl font-bold">{{ ai_stats.generated_articles|default:0 }}</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4">
                        <div class="text-sm text-white/70 mb-1">–ó–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                        <div class="text-2xl font-bold">{{ ai_stats.completed_tasks|default:0 }}</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4">
                        <div class="text-sm text-white/70 mb-1">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</div>
                        <div class="text-2xl font-bold">{{ ai_stats.active_schedules|default:0 }}</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4">
                        <div class="text-sm text-white/70 mb-1">–î–∏–∞–ª–æ–≥–æ–≤ –≤ —á–∞—Ç–µ</div>
                        <div class="text-2xl font-bold">{{ ai_stats.chat_conversations|default:0 }}</div>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4">
                    <a href="{% url 'asistent:admin_dashboard' %}" 
                       class="px-6 py-3 bg-white text-purple-600 font-bold rounded-lg hover:bg-white/90 transition-all transform hover:scale-105 shadow-lg inline-flex items-center">
                        üìä –ü–∞–Ω–µ–ª—å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
                    </a>
                    <a href="{% url 'asistent:ai_chat' %}" 
                       class="px-6 py-3 bg-white/20 border-2 border-white text-white font-bold rounded-lg hover:bg-white/30 transition-all inline-flex items-center">
                        üí¨ AI-–ß–∞—Ç
                    </a>
                    <a href="{% url 'asistent:ai_analytics_dashboard' %}" 
                       class="px-6 py-3 bg-white/20 border-2 border-white text-white font-bold rounded-lg hover:bg-white/30 transition-all inline-flex items-center">
                        üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                    </a>
                    <a href="{% url 'asistent:tasks_management' %}" 
                       class="px-6 py-3 bg-white/20 border-2 border-white text-white font-bold rounded-lg hover:bg-white/30 transition-all inline-flex items-center">
                        ‚úÖ –ó–∞–¥–∞–Ω–∏—è
                    </a>
                    <a href="/admin/" class="px-4 lg:px-6 py-2 lg:py-3 bg-gray-800 dark:bg-gray-700 text-white font-bold rounded-lg hover:bg-gray-900 dark:hover:bg-gray-600 transition-all shadow-lg inline-flex items-center justify-center gap-2 text-sm lg:text-base whitespace-nowrap">
                        ‚öôÔ∏è <span class="hidden sm:inline">Django –ê–¥–º–∏–Ω–∫–∞</span><span class="sm:hidden">–ê–¥–º–∏–Ω–∫–∞</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–æ–ª–∏ -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–æ–ª–∏ -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                        üìã –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–æ–ª–∏ ({{ pending_applications|length }})
                    </h2>
                    
                    {% if pending_applications %}
                    <div class="space-y-4">
                        {% for application in pending_applications %}
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-5">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <img src="{{ application.user.profile.get_avatar }}" 
                                         alt="{{ application.user.username }}"
                                         class="w-12 h-12 rounded-full">
                                    <div>
                                        <p class="font-semibold text-gray-900 dark:text-white">
                                            {{ application.user.username }}
                                        </p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">
                                            {{ application.user.email }}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300 rounded-full">
                                    {{ application.get_role_display }}
                                </span>
                            </div>
                            
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                                –ü–æ–¥–∞–Ω–∞: {{ application.applied_at|date:"d.m.Y H:i" }}
                            </p>

                            <form method="post" action="{% url 'Visitor:process_role_application' application.id %}" class="space-y-3">
                                {% csrf_token %}
                                <textarea name="admin_response" 
                                          placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                          rows="2"></textarea>
                                
                                <div class="flex space-x-2">
                                    <button type="submit" name="action" value="approve"
                                            class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors">
                                        ‚úì –û–¥–æ–±—Ä–∏—Ç—å
                                    </button>
                                    <button type="submit" name="action" value="reject"
                                            class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors">
                                        ‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                    </button>
                                </div>
                            </form>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-center text-gray-500 dark:text-gray-400 py-8">
                        –ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                    </p>
                    {% endif %}
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                            ‚úçÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤
                        </h2>
                        <span class="px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg font-semibold">
                            –í—Å–µ–≥–æ –∞–≤—Ç–æ—Ä–æ–≤: {{ total_authors|default:0 }}
                        </span>
                    </div>
                    
                    <!-- –ü–æ–∏—Å–∫ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    {% if page_all_time.paginator.count > 0 %}
                    <div class="mb-6 flex flex-col md:flex-row gap-4 items-center justify-between">
                        <!-- –ü–æ–∏—Å–∫ -->
                        <div class="flex-1 max-w-md">
                            <input type="text" 
                                   id="authors-filter" 
                                   placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∞–≤—Ç–æ—Ä–∞–º, —Å—Ç–∞—Ç—å—è–º, –¥–æ–Ω–∞—Ç–∞–º..." 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                   oninput="filterAllTables(this.value)">
                        </div>
                        
                        <!-- –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É -->
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-gray-700 dark:text-gray-300 whitespace-nowrap">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:</label>
                            <select onchange="changePerPage(this.value)" 
                                    class="px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-primary">
                                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                                <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- –ê–∫–∫–æ—Ä–¥–µ–æ–Ω —Å 4 –≤–∫–ª–∞–¥–∫–∞–º–∏ -->
                    <div class="space-y-3">
                        
                        <!-- –í–∫–ª–∞–¥–∫–∞ 1: –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è (–æ—Ç–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                            <button onclick="toggleAccordion('all-time')" 
                                    class="accordion-header w-full flex items-center justify-between px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 hover:from-blue-100 hover:to-indigo-100 dark:hover:from-blue-900/30 dark:hover:to-indigo-900/30 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üìä</span>
                                    <span class="text-lg font-bold text-gray-900 dark:text-white">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</span>
                                    <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-sm font-semibold">
                                        {{ page_all_time.paginator.count }} –∞–≤—Ç–æ—Ä–æ–≤
                                    </span>
                                </div>
                                <svg class="accordion-icon w-6 h-6 text-gray-600 dark:text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="all-time" class="accordion-content open">
                                {% include 'visitor/partials/authors_table.html' with stats=page_all_time totals=authors_totals_all_time period='all-time' per_page=per_page %}
                            </div>
                        </div>
                        
                        <!-- –í–∫–ª–∞–¥–∫–∞ 2: –ó–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                            <button onclick="toggleAccordion('last-month')" 
                                    class="accordion-header w-full flex items-center justify-between px-6 py-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 hover:from-purple-100 hover:to-pink-100 dark:hover:from-purple-900/30 dark:hover:to-pink-900/30 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üìÖ</span>
                                    <span class="text-lg font-bold text-gray-900 dark:text-white">–ó–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</span>
                                    <span class="px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full text-sm font-semibold">
                                        {{ page_last_month.paginator.count }} –∞–≤—Ç–æ—Ä–æ–≤
                                    </span>
                                </div>
                                <svg class="accordion-icon w-6 h-6 text-gray-600 dark:text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="last-month" class="accordion-content">
                                {% include 'visitor/partials/authors_table.html' with stats=page_last_month totals=authors_totals_last_month period='last-month' per_page=per_page %}
                            </div>
                        </div>
                        
                        <!-- –í–∫–ª–∞–¥–∫–∞ 3: –ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                            <button onclick="toggleAccordion('current-month')" 
                                    class="accordion-header w-full flex items-center justify-between px-6 py-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 hover:from-green-100 hover:to-emerald-100 dark:hover:from-green-900/30 dark:hover:to-emerald-900/30 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üìà</span>
                                    <span class="text-lg font-bold text-gray-900 dark:text-white">–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</span>
                                    <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-sm font-semibold">
                                        {{ page_current_month.paginator.count }} –∞–≤—Ç–æ—Ä–æ–≤
                                    </span>
                                </div>
                                <svg class="accordion-icon w-6 h-6 text-gray-600 dark:text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="current-month" class="accordion-content">
                                {% include 'visitor/partials/authors_table.html' with stats=page_current_month totals=authors_totals_current_month period='current-month' per_page=per_page %}
                            </div>
                        </div>
                        
                        <!-- –í–∫–ª–∞–¥–∫–∞ 4: –î–∏–Ω–∞–º–∏–∫–∞ -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                            <button onclick="toggleAccordion('dynamics')" 
                                    class="accordion-header w-full flex items-center justify-between px-6 py-4 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 hover:from-orange-100 hover:to-red-100 dark:hover:from-orange-900/30 dark:hover:to-red-900/30 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üîÑ</span>
                                    <span class="text-lg font-bold text-gray-900 dark:text-white">–î–∏–Ω–∞–º–∏–∫–∞ (—Ç–µ–∫—É—â–∏–π ‚Äî –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü)</span>
                                    <span class="px-3 py-1 bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 rounded-full text-sm font-semibold">
                                        {{ page_dynamics.paginator.count }} –∞–≤—Ç–æ—Ä–æ–≤
                                    </span>
                                </div>
                                <svg class="accordion-icon w-6 h-6 text-gray-600 dark:text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="dynamics" class="accordion-content">
                                {% include 'visitor/partials/authors_dynamics_table.html' with stats=page_dynamics totals=authors_totals_dynamics per_page=per_page %}
                            </div>
                        </div>
                        
                    </div>
                    
                    {% else %}
                    <p class="text-center text-gray-500 dark:text-gray-400 py-8">
                        –ü–æ–∫–∞ –Ω–µ—Ç –∞–≤—Ç–æ—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ
                    </p>
                    {% endif %}
                </div>

                <!-- AI-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è -->
                {% if ai_enabled %}
                <div class="bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-2xl shadow-xl p-6 border-2 border-purple-200 dark:border-purple-800">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                            ü§ñ AI-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
                        </h2>
                        <span class="px-3 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded-full">
                            –ê–∫—Ç–∏–≤–µ–Ω
                        </span>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è -->
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <a href="/admin/Moderation/articlemoderationsettings/add/" 
                           class="flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-sm font-semibold rounded-lg transition-all shadow-md hover:shadow-lg transform hover:scale-105">
                            <span class="text-lg">üìù</span>
                            <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π</span>
                        </a>
                        <a href="/admin/Moderation/commentmoderationsettings/add/" 
                           class="flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white text-sm font-semibold rounded-lg transition-all shadow-md hover:shadow-lg transform hover:scale-105">
                            <span class="text-lg">üí¨</span>
                            <span>–ö—Ä–∏—Ç–µ—Ä–∏–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</span>
                        </a>
                        <a href="{% url 'asistent:create_task' %}" 
                           class="flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white text-sm font-semibold rounded-lg transition-all shadow-md hover:shadow-lg transform hover:scale-105">
                            <span class="text-lg">‚úçÔ∏è</span>
                            <span>–ó–∞–¥–∞–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤</span>
                        </a>
                        <a href="{% url 'asistent:create_ai_schedule' %}" 
                           class="flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white text-sm font-semibold rounded-lg transition-all shadow-md hover:shadow-lg transform hover:scale-105">
                            <span class="text-lg">ü§ñ</span>
                            <span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</span>
                        </a>
                    </div>
                    
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π -->
                    <div class="mb-6">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            üìù –ö—Ä–∏—Ç–µ—Ä–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π ({{ article_criteria.count }})
                        </h3>
                        {% if article_criteria %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {% for criteria in article_criteria %}
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border {% if criteria.is_active %}border-green-300 dark:border-green-700{% else %}border-gray-300 dark:border-gray-700{% endif %}">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900 dark:text-white">{{ criteria.name }}</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">–°–æ–∑–¥–∞–Ω: {{ criteria.created_at|date:"d.m.Y H:i" }}</p>
                                    </div>
                                    <span class="px-2 py-1 text-xs font-medium rounded {% if criteria.is_active %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300{% else %}bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300{% endif %}">
                                        {% if criteria.is_active %}–ê–∫—Ç–∏–≤–µ–Ω{% else %}–í—ã–∫–ª—é—á–µ–Ω{% endif %}
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <label class="flex items-center gap-1 cursor-pointer">
                                        <input type="checkbox" 
                                               onchange="toggleCriteria('article', {{ criteria.id }}, this.checked)" 
                                               {% if criteria.is_active %}checked{% endif %}
                                               class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500">
                                        <span class="text-xs text-gray-700 dark:text-gray-300">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                    </label>
                                    <a href="/admin/Moderation/articlemoderationsettings/{{ criteria.id }}/change/" 
                                       class="flex-1 text-center px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    <button onclick="deleteCriteria('article', {{ criteria.id }}, '{{ criteria.name|escapejs }}')" 
                                            class="flex-1 px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded transition-colors">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 dark:text-gray-400">–ù–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π</p>
                        {% endif %}
                    </div>
                    
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                    <div class="mb-6">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            üí¨ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ ({{ comment_criteria.count }})
                        </h3>
                        {% if comment_criteria %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {% for criteria in comment_criteria %}
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border {% if criteria.is_active %}border-indigo-300 dark:border-indigo-700{% else %}border-gray-300 dark:border-gray-700{% endif %}">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900 dark:text-white">{{ criteria.name }}</h4>
                                        <p class="text-xs text-indigo-600 dark:text-indigo-400 mt-1">
                                            –î–µ–π—Å—Ç–≤–∏–µ: {{ criteria.get_action_display }}
                                        </p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">–°–æ–∑–¥–∞–Ω: {{ criteria.created_at|date:"d.m.Y H:i" }}</p>
                                    </div>
                                    <span class="px-2 py-1 text-xs font-medium rounded {% if criteria.is_active %}bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300{% else %}bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300{% endif %}">
                                        {% if criteria.is_active %}–ê–∫—Ç–∏–≤–µ–Ω{% else %}–í—ã–∫–ª—é—á–µ–Ω{% endif %}
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <label class="flex items-center gap-1 cursor-pointer">
                                        <input type="checkbox" 
                                               onchange="toggleCriteria('comment', {{ criteria.id }}, this.checked)" 
                                               {% if criteria.is_active %}checked{% endif %}
                                               class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-xs text-gray-700 dark:text-gray-300">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                    </label>
                                    <a href="/admin/Moderation/commentmoderationsettings/{{ criteria.id }}/change/" 
                                       class="flex-1 text-center px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    <button onclick="deleteCriteria('comment', {{ criteria.id }}, '{{ criteria.name|escapejs }}')" 
                                            class="flex-1 px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded transition-colors">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 dark:text-gray-400">–ù–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</p>
                        {% endif %}
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-6">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                        </h3>
                        <div class="grid grid-cols-3 gap-3">
                            <a href="/admin/Moderation/moderationlog/?content_type=comment" 
                               class="block p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 hover:from-blue-100 hover:to-cyan-100 dark:hover:from-blue-900/30 dark:hover:to-cyan-900/30 rounded-lg transition-colors">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫</p>
                                        <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ comment_moderation_stats.total }}</p>
                                    </div>
                                    <span class="text-2xl">üìä</span>
                                </div>
                            </a>
                            <a href="/admin/Moderation/moderationlog/?content_type=comment&passed__exact=1" 
                               class="block p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 hover:from-green-100 hover:to-emerald-100 dark:hover:from-green-900/30 dark:hover:to-emerald-900/30 rounded-lg transition-colors">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">–û–¥–æ–±—Ä–µ–Ω–æ</p>
                                        <p class="text-2xl font-bold text-green-600 dark:text-green-400">{{ comment_moderation_stats.passed }}</p>
                                    </div>
                                    <span class="text-2xl">‚úÖ</span>
                                </div>
                            </a>
                            <a href="/admin/Moderation/moderationlog/?content_type=comment&passed__exact=0" 
                               class="block p-4 bg-gradient-to-r from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 hover:from-red-100 hover:to-pink-100 dark:hover:from-red-900/30 dark:hover:to-pink-900/30 rounded-lg transition-colors">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</p>
                                        <p class="text-2xl font-bold text-red-600 dark:text-red-400">{{ comment_moderation_stats.blocked }}</p>
                                    </div>
                                    <span class="text-2xl">üö´</span>
                                </div>
                            </a>
                        </div>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤ -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-6">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            ‚úçÔ∏è –ó–∞–¥–∞–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤
                        </h3>
                        <div class="grid grid-cols-4 gap-3 mb-4">
                            <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ tasks_stats.total }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π</p>
                            </div>
                            <div class="text-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">{{ tasks_stats.in_progress }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–í —Ä–∞–±–æ—Ç–µ</p>
                            </div>
                            <div class="text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">{{ tasks_stats.authors_count }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–ê–≤—Ç–æ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç</p>
                            </div>
                            <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <p class="text-2xl font-bold text-green-600 dark:text-green-400">{{ tasks_stats.completed }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                            </div>
                        </div>
                        <a href="{% url 'asistent:tasks_management' %}" 
                           class="block text-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white text-sm font-medium rounded-lg transition-all">
                            üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏
                        </a>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ AI –≤ 3 –∫–æ–ª–æ–Ω–∫–∏ -->
                    <div class="mb-6">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            ü§ñ –ó–∞–¥–∞–Ω–∏—è –¥–ª—è AI
                        </h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
                                <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">{{ ai_stats.tasks_for_review }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</p>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
                                <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ ai_stats.tasks_in_progress }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–í —Ä–∞–±–æ—Ç–µ</p>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
                                <p class="text-2xl font-bold text-green-600 dark:text-green-400">{{ ai_stats.completed_tasks }}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">{{ ai_stats.available_tasks }}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–î–æ—Å—Ç—É–ø–Ω–æ</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-red-600 dark:text-red-400">{{ ai_stats.overdue_tasks }}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">{{ ai_stats.ai_articles_today }}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">AI —Å—Ç–∞—Ç–µ–π —Å–µ–≥–æ–¥–Ω—è</p>
                        </div>
                    </div>
                    
                    <!-- –ó–∞–¥–∞–Ω–∏—è –Ω–∞ AI –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                    {% if tasks_for_review %}
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            ‚è≥ –ù–∞ AI –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ({{ tasks_for_review|length }})
                        </h3>
                        <div class="space-y-3 max-h-64 overflow-y-auto">
                            {% for assignment in tasks_for_review %}
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <p class="font-medium text-gray-900 dark:text-white text-sm">{{ assignment.task.title }}</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                                            –ê–≤—Ç–æ—Ä: {{ assignment.author.username }} | –°–¥–∞–Ω–æ: {{ assignment.submitted_at|date:"d.m H:i" }}
                                        </p>
                                    </div>
                                    <span class="text-xs font-medium px-2 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300 rounded">
                                        {{ assignment.task.reward }}‚ÇΩ
                                    </span>
                                </div>
                                <div class="flex space-x-2">
                                    {% if assignment.article %}
                                    <a href="{{ assignment.article.get_absolute_url }}" target="_blank"
                                       class="flex-1 text-center px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">
                                        üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—å–∏
                                    </a>
                                    {% endif %}
                                    <span class="flex-1 text-center px-3 py-1 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300 rounded">
                                        ü§ñ AI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç...
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è -->
                    {% if overdue_tasks %}
                    <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4 mb-4 border border-red-200 dark:border-red-800">
                        <h3 class="font-semibold text-red-900 dark:text-red-300 mb-2">
                            ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è ({{ overdue_tasks.count }})
                        </h3>
                        <div class="space-y-2">
                            {% for task in overdue_tasks|slice:":3" %}
                            <div class="text-xs text-red-800 dark:text-red-300">
                                ‚Ä¢ {{ task.title }} - –°—Ç–∞—Ç—É—Å: {{ task.get_status_display }} (–¥–æ {{ task.deadline|date:"d.m H:i" }})
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è AI -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                            üìÖ –ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è AI ({{ ai_schedules|length }})
                        </h3>
                        {% if ai_schedules %}
                        <div class="space-y-2">
                            {% for schedule in ai_schedules|slice:":3" %}
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-700 dark:text-gray-300">{{ schedule.name }}</span>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">
                                        {{ schedule.get_posting_frequency_display }}
                                    </span>
                                    <form method="post" action="{% url 'Visitor:ai_run_schedule' schedule.id %}" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" 
                                                class="text-xs px-2 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded">
                                            ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å
                                        </button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-xs text-gray-500 dark:text-gray-400">–†–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                    
                    <!-- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                    <a href="/admin/Moderation/" class="block bg-white dark:bg-gray-800 rounded-lg p-4 mb-4 hover:ring-2 hover:ring-purple-500 transition-all">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-gray-900 dark:text-white">
                                üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                            </h3>
                            <span class="text-xs px-2 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300 rounded">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
                            </span>
                        </div>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">
                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç–µ–π –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                        </p>
                    </a>
                    
                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è AI -->
                    <div class="grid grid-cols-2 gap-2">
                       
                        <a href="{% url 'Visitor:ai_schedules' %}" 
                           class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg text-center transition-colors">
                            ü§ñ –†–∞—Å–ø–∏—Å–∞–Ω–∏—è AI
                        </a>
                       
                        <a href="{% url 'Visitor:task_calendar' %}" 
                           class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg text-center transition-colors">
                            üìÜ –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                        </a>
                    </div>
                </div>
                {% endif %}

            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
            <div class="space-y-6">
                
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
                    </h2>
                    
                    {% if recent_activities %}
                    <div class="space-y-3 max-h-[800px] overflow-y-auto">
                        {% for activity in recent_activities %}
                        <div class="border-l-4 border-primary pl-3 py-2">
                            <p class="text-sm text-gray-900 dark:text-white font-medium">
                                {{ activity.get_action_type_display }}
                            </p>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                                {% if activity.user %}{{ activity.user.username }}{% else %}–°–∏—Å—Ç–µ–º–∞{% endif %}
                                {% if activity.target_user %}‚Üí {{ activity.target_user.username }}{% endif %}
                            </p>
                            {% if activity.description %}
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                {{ activity.description|truncatewords:15 }}
                            </p>
                            {% endif %}
                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">
                                {{ activity.created_at|date:"d.m.Y H:i" }}
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-center text-gray-500 dark:text-gray-400 py-8">
                        –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                    </p>
                    {% endif %}
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        ‚ö° –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏
                    </h2>
                    <div class="space-y-2">
                        <a href="{% url 'admin:index' %}" 
                           class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                            üîß Django Admin
                        </a>
                        <a href="{% url 'Visitor:personal_cabinet' %}" 
                           class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                            üë§ –ú–æ–π –∫–∞–±–∏–Ω–µ—Ç
                        </a>
                        <a href="{% url 'blog:post_list' %}" 
                           class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                            üì∞ –ù–∞ –≥–ª–∞–≤–Ω—É—é
                        </a>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è -->
<div id="rejectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-6">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
            –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
        </h3>
        <p id="rejectTaskTitle" class="text-gray-600 dark:text-gray-400 mb-4"></p>
        <form id="rejectForm" method="post" action="">
            {% csrf_token %}
            <textarea name="reason" 
                      placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è..."
                      required
                      class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                      rows="4"></textarea>
            <div class="flex space-x-3 mt-4">
                <button type="button" onclick="closeRejectModal()"
                        class="flex-1 px-4 py-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-900 dark:text-white font-medium rounded-lg transition-colors">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button type="submit"
                        class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors">
                    –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                </button>
            </div>
        </form>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ */
.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.accordion-content.open {
    max-height: 10000px;
    transition: max-height 0.5s ease-in;
}

.accordion-header .accordion-icon {
    transition: transform 0.3s ease;
}

.accordion-header.active .accordion-icon {
    transform: rotate(180deg);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ */
.sort-indicator {
    display: inline-block;
    margin-left: 4px;
    font-size: 10px;
    color: #9ca3af;
}

.sort-indicator::after {
    content: '‚áÖ';
}

.sort-indicator.asc::after {
    content: '‚Üë';
    color: #3b82f6;
}

.sort-indicator.desc::after {
    content: '‚Üì';
    color: #3b82f6;
}

/* –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ */
.table-row.hidden {
    display: none;
}

.table-row.highlight {
    background-color: rgba(59, 130, 246, 0.1) !important;
}
</style>

<script>
// ========================================
// –§–£–ù–ö–¶–ò–ò –ê–ö–ö–û–†–î–ï–û–ù–ê
// ========================================
function toggleAccordion(id) {
    const content = document.getElementById(id);
    const header = content.previousElementSibling;
    
    if (content.classList.contains('open')) {
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º
        content.classList.remove('open');
        header.classList.remove('active');
    } else {
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ)
        content.classList.add('open');
        header.classList.add('active');
    }
}

// –û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    const allTimeContent = document.getElementById('all-time');
    if (allTimeContent) {
        const header = allTimeContent.previousElementSibling;
        header.classList.add('active');
    }
});

// ========================================
// –ñ–ò–í–û–ô –ü–û–ò–°–ö –ü–û –í–°–ï–ú –¢–ê–ë–õ–ò–¶–ê–ú
// ========================================
function filterAllTables(query) {
    const searchQuery = query.toLowerCase().trim();
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ—Ä–æ–≤
    const tables = document.querySelectorAll('.authors-table');
    
    tables.forEach(table => {
        const rows = table.querySelectorAll('tbody .table-row');
        
        rows.forEach(row => {
            if (!searchQuery) {
                // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ
                row.classList.remove('hidden', 'highlight');
                return;
            }
            
            // –ò—â–µ–º –ø–æ –≤—Å–µ–º data-–∞—Ç—Ä–∏–±—É—Ç–∞–º –∏ —Ç–µ–∫—Å—Ç—É
            const author = row.dataset.author || '';
            const posts = row.dataset.posts || '';
            const views = row.dataset.views || '';
            const likes = row.dataset.likes || '';
            const comments = row.dataset.comments || '';
            const donations = row.dataset.donations || '';
            const subscribers = row.dataset.subscribers || '';
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
            const searchableText = `${author} ${posts} ${views} ${likes} ${comments} ${donations} ${subscribers}`.toLowerCase();
            
            if (searchableText.includes(searchQuery)) {
                row.classList.remove('hidden');
                row.classList.add('highlight');
            } else {
                row.classList.add('hidden');
                row.classList.remove('highlight');
            }
        });
    });
}

// ========================================
// –°–û–†–¢–ò–†–û–í–ö–ê –¢–ê–ë–õ–ò–¶
// ========================================
let sortStates = {}; // –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã

function sortTable(header, column, period) {
    const table = header.closest('table');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('.table-row'));
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    const key = `${period}-${column}`;
    const currentState = sortStates[key] || 'none';
    let newState = 'asc';
    
    if (currentState === 'none') {
        newState = 'desc'; // –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫ - –ø–æ —É–±—ã–≤–∞–Ω–∏—é
    } else if (currentState === 'desc') {
        newState = 'asc'; // –í—Ç–æ—Ä–æ–π –∫–ª–∏–∫ - –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
    } else {
        newState = 'desc'; // –¢—Ä–µ—Ç–∏–π –∫–ª–∏–∫ - —Å–Ω–æ–≤–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é
    }
    
    sortStates[key] = newState;
    
    // –û—á–∏—â–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ
    table.querySelectorAll('.sort-indicator').forEach(indicator => {
        indicator.className = 'sort-indicator';
    });
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–æ–ª–æ–Ω–∫–∏
    const indicator = header.querySelector('.sort-indicator');
    indicator.className = `sort-indicator ${newState}`;
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏
    rows.sort((a, b) => {
        let aVal, bVal;
        
        if (column === 'author') {
            aVal = a.dataset.author;
            bVal = b.dataset.author;
            // –°—Ç—Ä–æ–∫–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            return newState === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        } else {
            // –ß–∏—Å–ª–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            const dataAttr = column === 'posts' ? 'posts' : 
                            column === 'views' ? 'views' :
                            column === 'likes' ? 'likes' :
                            column === 'comments' ? 'comments' :
                            column === 'donations' ? 'donations' :
                            column === 'subscribers' ? 'subscribers' :
                            column === 'bonus' ? 'bonus' : column;
            
            aVal = parseFloat(a.dataset[dataAttr]) || 0;
            bVal = parseFloat(b.dataset[dataAttr]) || 0;
            
            return newState === 'asc' ? aVal - bVal : bVal - aVal;
        }
    });
    
    // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
    rows.forEach(row => tbody.appendChild(row));
}

// ========================================
// –ò–ó–ú–ï–ù–ï–ù–ò–ï –ö–û–õ–ò–ß–ï–°–¢–í–ê –ù–ê –°–¢–†–ê–ù–ò–¶–£
// ========================================
function changePerPage(value) {
    const url = new URL(window.location.href);
    url.searchParams.set('per_page', value);
    url.searchParams.set('page', '1'); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    window.location.href = url.toString();
}

// ========================================
// –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–†–ò–¢–ï–†–ò–Ø–ú–ò –ú–û–î–ï–†–ê–¶–ò–ò
// ========================================
function getCsrfToken() {
    const cookieValue = document.cookie
        .split('; ')
        .find(row => row.startsWith('csrftoken='))
        ?.split('=')[1];
    return cookieValue;
}

async function toggleCriteria(type, id, isActive) {
    try {
        const response = await fetch(`/asistent/criteria/toggle/${type}/${id}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken(),
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({is_active: isActive})
        });
        
        const data = await response.json();
        
        if (data.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å'));
            location.reload();
        }
    } catch (error) {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
        location.reload();
    }
}

async function deleteCriteria(type, id, name) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–π "${name}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`)) {
        return;
    }
    
    try {
        const url = type === 'article' 
            ? `/asistent/criteria/articles/${id}/delete/`
            : `/asistent/criteria/comments/${id}/delete/`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCsrfToken(),
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω!');
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–π'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
    }
}

// ========================================
// –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –û–¢–ö–õ–û–ù–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø
// ========================================
function showRejectModal(taskId, taskTitle) {
    const modal = document.getElementById('rejectModal');
    const form = document.getElementById('rejectForm');
    const title = document.getElementById('rejectTaskTitle');
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Django URL pattern
    const rejectUrl = "{% url 'Visitor:ai_reject_task' 0 %}".replace('/0/', `/${taskId}/`);
    form.action = rejectUrl;
    title.textContent = `–ó–∞–¥–∞–Ω–∏–µ: ${taskTitle}`;
    modal.classList.remove('hidden');
}

function closeRejectModal() {
    const modal = document.getElementById('rejectModal');
    modal.classList.add('hidden');
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
document.getElementById('rejectModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeRejectModal();
    }
});
</script>
{% endblock %}



