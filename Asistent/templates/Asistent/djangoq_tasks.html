{% extends 'base_tailwind.html' %}
{% load static %}
{% load djangoq_filters %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<!-- –ê–¥–º–∏–Ω –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
{% include 'partials/admin_navigation.html' %}

<div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="mb-8">
            <div class="flex items-center justify-between flex-wrap gap-4 mb-6">
                <div>
                    <h1 class="text-4xl font-black text-white mb-2">{{ title }}</h1>
                    <p class="text-xl text-gray-300">{{ description }}</p>
                </div>
                <div class="flex gap-3">
                    <a href="{% url 'asistent:djangoq_task_create' %}" 
                       class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors flex items-center gap-2 shadow-lg">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                        </svg>
                        –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                    </a>
                    <a href="{% url 'Home:master_admin_dashboard' %}" 
                       class="px-6 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-md text-white font-semibold rounded-lg transition-colors border border-white/20 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        –ù–∞–∑–∞–¥
                    </a>
                </div>
            </div>
            
            {% if task_type == 'all' %}
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: —Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
            <div class="space-y-4">
                <!-- –°—Ç—Ä–æ–∫–∞ 1: –§–∏–ª—å—Ç—Ä—ã —Ç–∏–ø–∞ –∑–∞–¥–∞—á -->
                <div class="flex gap-3 flex-wrap">
                    <a href="?type=success&view={{ view_mode }}&sort={{ sort_by }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                       class="px-4 py-2 {% if filter_type == 'success' %}bg-blue-600{% else %}bg-white/10{% endif %} hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        –£—Å–ø–µ—à–Ω—ã–µ
                    </a>
                    <a href="?type=failed&view={{ view_mode }}&sort={{ sort_by }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                       class="px-4 py-2 {% if filter_type == 'failed' %}bg-red-600{% else %}bg-white/10{% endif %} hover:bg-red-700 text-white font-semibold rounded-lg transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        –ü—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
                    </a>
                </div>
                
                <!-- –°—Ç—Ä–æ–∫–∞ 2: –ü–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                <div class="flex gap-4 flex-wrap items-center bg-white/5 backdrop-blur-md rounded-xl p-4 border border-white/10">
                    <!-- –ü–æ–∏—Å–∫ -->
                    <form method="get" class="flex-1 min-w-[300px]">
                        <input type="hidden" name="type" value="{{ filter_type }}">
                        <input type="hidden" name="sort" value="{{ sort_by }}">
                        <input type="hidden" name="view" value="{{ view_mode }}">
                        <div class="relative">
                            <input type="text" 
                                   name="search" 
                                   value="{{ search_query }}"
                                   placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–∏, –≥—Ä—É–ø–ø–µ..."
                                   class="w-full px-4 py-2 pl-10 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </form>
                    
                    <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
                    <div class="flex items-center gap-2">
                        <label class="text-white font-semibold text-sm">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                        <select onchange="updateSort(this.value)" 
                                class="px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="-stopped" {% if sort_by == '-stopped' %}selected{% endif %}>‚è∞ –ù–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ</option>
                            <option value="stopped" {% if sort_by == 'stopped' %}selected{% endif %}>‚è∞ –°—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–µ</option>
                            <option value="func" {% if sort_by == 'func' %}selected{% endif %}>üìù –ù–∞–∑–≤–∞–Ω–∏–µ –ê-–Ø</option>
                            <option value="-func" {% if sort_by == '-func' %}selected{% endif %}>üìù –ù–∞–∑–≤–∞–Ω–∏–µ –Ø-–ê</option>
                            <option value="-time_taken" {% if sort_by == '-time_taken' %}selected{% endif %}>‚ö° –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–≤—ã–µ</option>
                            <option value="time_taken" {% if sort_by == 'time_taken' %}selected{% endif %}>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–≤—ã–µ</option>
                        </select>
                    </div>
                    
                    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class="flex items-center gap-2 bg-white/10 rounded-lg p-1">
                        <a href="?type={{ filter_type }}&sort={{ sort_by }}&view=grid{% if search_query %}&search={{ search_query }}{% endif %}"
                           class="px-3 py-2 {% if view_mode == 'grid' %}bg-purple-600{% else %}hover:bg-white/10{% endif %} text-white rounded-lg transition-colors flex items-center gap-2"
                           title="–†–µ–∂–∏–º —Å–µ—Ç–∫–∏">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                            </svg>
                            <span class="hidden sm:inline">–°–µ—Ç–∫–∞</span>
                        </a>
                        <a href="?type={{ filter_type }}&sort={{ sort_by }}&view=table{% if search_query %}&search={{ search_query }}{% endif %}"
                           class="px-3 py-2 {% if view_mode == 'table' %}bg-purple-600{% else %}hover:bg-white/10{% endif %} text-white rounded-lg transition-colors flex items-center gap-2"
                           title="–†–µ–∂–∏–º —Ç–∞–±–ª–∏—Ü—ã">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            <span class="hidden sm:inline">–¢–∞–±–ª–∏—Ü–∞</span>
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á –∏–ª–∏ –¢–∞–±–ª–∏—Ü–∞ -->
        {% if tasks %}
        
        {% if view_mode == 'table' %}
        <!-- –†–µ–∂–∏–º —Ç–∞–±–ª–∏—Ü—ã -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 overflow-hidden shadow-xl">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white">
                            <th class="px-6 py-4 text-left font-bold">–ó–∞–¥–∞—á–∞</th>
                            <th class="px-6 py-4 text-left font-bold hidden lg:table-cell">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th class="px-6 py-4 text-left font-bold">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                            <th class="px-6 py-4 text-left font-bold hidden xl:table-cell">–î–∞—Ç–∞</th>
                            <th class="px-6 py-4 text-center font-bold">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/10">
                        {% for task in tasks %}
                        <tr class="hover:bg-white/5 transition-colors">
                            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ -->
                            <td class="px-6 py-4">
                                <div class="flex flex-col gap-1">
                                    <span class="text-white font-semibold">{{ task.func|task_formatted }}</span>
                                    <code class="text-xs text-gray-400 font-mono">{{ task.id|truncatechars:20 }}</code>
                                    <span class="text-xs text-cyan-300">{{ task.func|task_description }}</span>
                                </div>
                            </td>
                            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                            <td class="px-6 py-4 hidden lg:table-cell">
                                <span class="text-gray-300 text-sm">
                                    {% if task.kwargs.category_id %}
                                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è #{{ task.kwargs.category_id }}
                                    {% elif task.group %}
                                        {{ task.group }}
                                    {% else %}
                                        <span class="text-gray-500">–ù–µ —É–∫–∞–∑–∞–Ω–∞</span>
                                    {% endif %}
                                </span>
                            </td>
                            <!-- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                            <td class="px-6 py-4">
                                {% if task.time_taken %}
                                <span class="px-3 py-1 bg-green-600/30 text-green-300 rounded-full text-sm font-semibold">
                                    {{ task.time_taken|floatformat:2 }}—Å
                                </span>
                                {% else %}
                                <span class="text-gray-500 text-sm">N/A</span>
                                {% endif %}
                            </td>
                            <!-- –î–∞—Ç–∞ -->
                            <td class="px-6 py-4 hidden xl:table-cell">
                                <div class="flex flex-col gap-1">
                                    <span class="text-white text-sm">{{ task.stopped|date:"d.m.Y H:i" }}</span>
                                    <span class="text-xs text-gray-400">{{ task.stopped|timesince }} –Ω–∞–∑–∞–¥</span>
                                </div>
                            </td>
                            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                            <td class="px-6 py-4 text-center">
                                <a href="{% url 'asistent:djangoq_task_detail' task.id task_type %}" 
                                   class="inline-flex items-center px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-semibold">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    –î–µ—Ç–∞–ª–∏
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        {% else %}
        <!-- –†–µ–∂–∏–º —Å–µ—Ç–∫–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% for task in tasks %}
            <div class="bg-white/10 backdrop-blur-md rounded-2xl border {% if task_type == 'queued' %}border-yellow-500/30{% elif task_type == 'active' %}border-blue-500/30{% elif task_type == 'recent' %}border-green-500/30{% else %}border-white/20{% endif %} overflow-hidden shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-[1.02]">
                
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                <div class="{% if task_type == 'queued' %}bg-gradient-to-r from-yellow-600 to-amber-700{% elif task_type == 'active' %}bg-gradient-to-r from-blue-600 to-cyan-700{% elif task_type == 'recent' %}bg-gradient-to-r from-green-600 to-emerald-700{% else %}bg-gradient-to-r from-purple-600 to-indigo-700{% endif %} px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h3 class="font-bold text-white text-lg truncate">{{ task.func|task_formatted }}</h3>
                            <code class="text-xs text-white/70 font-mono">ID: {{ task.id|truncatechars:12 }}</code>
                        </div>
                        <div>
                            {% if task_type == 'active' or task_type == 'queued' %}
                                {% if task.lock %}
                                <span class="px-3 py-1 bg-white/20 text-white rounded-full text-xs font-semibold flex items-center gap-1">
                                    <svg class="w-3 h-3 animate-spin" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                    </svg>
                                    –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
                                </span>
                                {% else %}
                                <span class="px-3 py-1 bg-white/20 text-white rounded-full text-xs font-semibold">–í –æ—á–µ—Ä–µ–¥–∏</span>
                                {% endif %}
                            {% else %}
                                <span class="px-3 py-1 bg-white/20 text-white rounded-full text-xs font-semibold">
                                    {% if task.time_taken %}{{ task.time_taken|floatformat:2 }}—Å{% else %}N/A{% endif %}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                <div class="p-6 space-y-4">
                    <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                    <div>
                        <h6 class="flex items-center gap-2 text-white/90 font-semibold mb-3">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
                        </h6>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start gap-2">
                                <svg class="w-4 h-4 text-purple-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                                <div class="flex-1">
                                    <span class="text-gray-400">–§—É–Ω–∫—Ü–∏—è:</span>
                                    <code class="block text-white/80 font-mono text-xs mt-1 bg-black/20 px-2 py-1 rounded break-all">{{ task.func }}</code>
                                    <span class="block text-cyan-300 text-sm mt-1">{{ task.func|task_description }}</span>
                                </div>
                            </li>
                            <li class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-blue-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                                </svg>
                                <span class="text-gray-400">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                                <span class="text-white font-semibold">
                                    {% if task.kwargs.category_id %}
                                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è #{{ task.kwargs.category_id }}
                                    {% elif task.group %}
                                        {{ task.group }}
                                    {% else %}
                                        –ù–µ —É–∫–∞–∑–∞–Ω–∞
                                    {% endif %}
                                </span>
                            </li>
                            <li class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-gray-400">–ß–∞—Å—Ç–æ—Ç–∞:</span>
                                <span class="text-white font-semibold">
                                    {% if task.kwargs.schedule_id %}
                                        –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ #{{ task.kwargs.schedule_id }}
                                    {% else %}
                                        –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è
                                    {% endif %}
                                </span>
                            </li>
                            <li class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-yellow-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
                                </svg>
                                <span class="text-gray-400">–°—Ç–∞—Ç–µ–π –∑–∞ —Ä–∞–∑:</span>
                                <span class="text-white font-semibold">
                                    {% if task.kwargs.articles_count %}
                                        {{ task.kwargs.articles_count }}
                                    {% else %}
                                        1
                                    {% endif %}
                                </span>
                            </li>
                            <li class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-pink-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-gray-400">–°–ª–æ–≤:</span>
                                <span class="text-white font-semibold">
                                    {% if task.kwargs.min_word_count and task.kwargs.max_word_count %}
                                        {{ task.kwargs.min_word_count }} - {{ task.kwargs.max_word_count }}
                                    {% elif task.kwargs.word_count %}
                                        {{ task.kwargs.word_count }}
                                    {% else %}
                                        –ù–µ —É–∫–∞–∑–∞–Ω–æ
                                    {% endif %}
                                </span>
                            </li>
                            {% if task.kwargs.task_id %}
                            <li class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-orange-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-gray-400">–°–≤—è–∑–∞–Ω–æ —Å:</span>
                                <a href="{% url 'asistent:content_task_detail' task.kwargs.task_id %}" 
                                   class="text-blue-400 hover:text-blue-300 font-semibold">
                                    ContentTask #{{ task.kwargs.task_id }}
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <!-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
                    {% if task.kwargs.source_urls or task.kwargs.urls %}
                    <div>
                        <h6 class="flex items-center gap-2 text-white/90 font-semibold mb-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"></path>
                            </svg>
                            –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
                        </h6>
                        <ul class="text-xs text-gray-300 space-y-1">
                            {% with urls=task.kwargs.source_urls|default:task.kwargs.urls %}
                            {% if urls %}
                                {% for url in urls|slice:":3" %}
                                <li class="truncate">‚Ä¢ {{ url }}</li>
                                {% endfor %}
                                {% if urls|length > 3 %}
                                <li class="text-gray-500">–∏ –µ—â–µ {{ urls|length|add:"-3" }}...</li>
                                {% endif %}
                            {% endif %}
                            {% endwith %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
                    <div>
                        <h6 class="flex items-center gap-2 text-white/90 font-semibold mb-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                            </svg>
                            –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:
                        </h6>
                        <ul class="text-sm space-y-1">
                            {% if task_type == 'active' or task_type == 'queued' %}
                                {% if task.lock %}
                                <li class="text-gray-300"><strong class="text-white">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫:</strong> {{ task.lock|timesince }} –Ω–∞–∑–∞–¥</li>
                                <li class="text-gray-300"><strong class="text-white">–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫:</strong> <span class="text-blue-300">–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–µ–π—á–∞—Å</span></li>
                                {% else %}
                                <li class="text-gray-300"><strong class="text-white">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫:</strong> –ù–µ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—å</li>
                                <li class="text-gray-300"><strong class="text-white">–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫:</strong> <span class="text-yellow-300">–û–∂–∏–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏</span></li>
                                {% endif %}
                            {% else %}
                                <li class="text-gray-300">
                                    <strong class="text-white">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫:</strong> {{ task.stopped|date:"d.m.Y H:i" }}
                                    <span class="text-xs text-gray-400">({{ task.stopped|timesince }} –Ω–∞–∑–∞–¥)</span>
                                </li>
                                <li class="text-gray-300">
                                    <strong class="text-white">–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫:</strong> 
                                    {% if task.kwargs.schedule_id %}
                                        <span class="text-green-300">–ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é #{{ task.kwargs.schedule_id }}</span>
                                    {% else %}
                                        <span class="text-gray-500">–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è)</span>
                                    {% endif %}
                                </li>
                                <li class="text-gray-300">
                                    <strong class="text-white">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> 
                                    {% if task.time_taken %}
                                    <span class="text-green-300">{{ task.time_taken|floatformat:2 }} —Å–µ–∫—É–Ω–¥</span>
                                    {% else %}
                                    <span class="text-gray-500">N/A</span>
                                    {% endif %}
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                
                <!-- –§—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
                <div class="px-6 py-4 bg-white/5 border-t border-white/10">
                    <div class="flex gap-2 justify-end flex-wrap">
                        {% if show_actions %}
                        <form method="post" action="{% url 'asistent:djangoq_task_run_now' task.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" 
                                    class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm font-semibold shadow-lg">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                                </svg>
                                –ó–∞–ø—É—Å—Ç–∏—Ç—å
                            </button>
                        </form>
                        <a href="{% url 'asistent:djangoq_task_detail' task.id task_type %}" 
                           class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm font-semibold">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                            </svg>
                            –î–µ—Ç–∞–ª–∏
                        </a>
                        <button type="button" 
                                onclick="confirmDelete('{{ task.name|default:"–∑–∞–¥–∞—á—É" }}', '{{ task.id }}')" 
                                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm font-semibold">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                        <form id="delete-form-{{ task.id }}" method="post" action="{% url 'asistent:djangoq_task_delete' task.id %}" style="display: none;">
                            {% csrf_token %}
                        </form>
                        {% else %}
                        <a href="{% url 'asistent:djangoq_task_detail' task.id task_type %}" 
                           class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm font-semibold">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                            </svg>
                            –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        {% if show_pagination and tasks.has_other_pages %}
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div class="mt-8 flex justify-center">
            <nav class="flex items-center gap-2">
                {% if tasks.has_previous %}
                <a href="?page=1&type={{ filter_type }}&sort={{ sort_by }}&view={{ view_mode }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                    </svg>
                </a>
                <a href="?page={{ tasks.previous_page_number }}&type={{ filter_type }}&sort={{ sort_by }}&view={{ view_mode }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </a>
                {% endif %}
                
                <span class="px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ tasks.number }} –∏–∑ {{ tasks.paginator.num_pages }}
                </span>
                
                {% if tasks.has_next %}
                <a href="?page={{ tasks.next_page_number }}&type={{ filter_type }}&sort={{ sort_by }}&view={{ view_mode }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </a>
                <a href="?page={{ tasks.paginator.num_pages }}&type={{ filter_type }}&sort={{ sort_by }}&view={{ view_mode }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                        <path fill-rule="evenodd" d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
        
        {% else %}
        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-12 text-center shadow-2xl">
            <svg class="w-24 h-24 mx-auto text-white/30 mb-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
            </svg>
            <h3 class="text-2xl font-bold text-white mb-2">–ó–∞–¥–∞—á –Ω–µ—Ç</h3>
            <p class="text-gray-400 mb-6">{{ description }}</p>
            {% if show_actions %}
            <a href="{% url 'asistent:djangoq_task_create' %}" 
               class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                </svg>
                –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
            </a>
            {% endif %}
        </div>
        {% endif %}
        
    </div>
</div>

<script>
function confirmDelete(taskName, taskId) {
    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É "${taskName}"?`)) {
        document.getElementById('delete-form-' + taskId).submit();
    }
}

function updateSort(sortValue) {
    const url = new URL(window.location.href);
    url.searchParams.set('sort', sortValue);
    window.location.href = url.toString();
}
</script>
{% endblock %}
