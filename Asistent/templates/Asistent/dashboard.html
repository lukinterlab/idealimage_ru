{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Dashboard –º–µ—Ç—Ä–∏–∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞{% endblock %}

{% block extrastyle %}
<style>
    .metrics-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    .metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #2c3e50;
    }
    .metric-label {
        color: #7f8c8d;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .trend-up {
        color: #27ae60;
    }
    .trend-down {
        color: #e74c3c;
    }
    .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 30px;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .comparison-table {
        width: 100%;
        border-collapse: collapse;
    }
    .comparison-table th,
    .comparison-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ecf0f1;
    }
    .comparison-table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }
    .badge-success {
        background-color: #27ae60;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
    }
    .badge-warning {
        background-color: #f39c12;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
    }
    .badge-danger {
        background-color: #e74c3c;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
    }
    .schedule-item {
        padding: 15px;
        border: 1px solid #ecf0f1;
        border-radius: 6px;
        margin-bottom: 10px;
        background: #f8f9fa;
    }
    .progress-bar {
        background-color: #e0e0e0;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 style="margin: 0; font-size: 2rem;">üìä Dashboard –º–µ—Ç—Ä–∏–∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</h1>
    <p style="margin: 10px 0 0 0; opacity: 0.9;">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
</div>

<!-- –ü–µ—Ä–∏–æ–¥ –≤—ã–±–æ—Ä–∞ -->
<div class="metrics-card">
    <form method="get" style="display: flex; align-items: center; gap: 15px;">
        <label for="period" style="font-weight: 600;">–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:</label>
        <select name="period" id="period" onchange="this.form.submit()" style="padding: 8px 15px; border-radius: 4px; border: 1px solid #ddd;">
            {% for p in available_periods %}
            <option value="{{ p }}" {% if p == period_days %}selected{% endif %}>{{ p }} –¥–Ω–µ–π</option>
            {% endfor %}
        </select>
        <span style="color: #7f8c8d;">–û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ now|date:"d.m.Y H:i" }}</span>
    </form>
</div>

<!-- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<h2 style="margin-top: 30px; margin-bottom: 20px;">üìÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
<div class="stats-grid">
    <div class="metrics-card">
        <div class="metric-label">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å—Ç–∞—Ç–µ–π</div>
        <div class="metric-value">{{ daily_stats.generated_today }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ daily_stats.published_count }}</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>
        <div class="metric-value" style="font-size: 1.8rem;">{{ daily_stats.avg_generation_time }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">{{ daily_stats.avg_generation_time_raw }} —Å–µ–∫—É–Ω–¥</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">Success Rate</div>
        <div class="metric-value" style="color: {% if daily_stats.success_rate >= 90 %}#27ae60{% elif daily_stats.success_rate >= 70 %}#f39c12{% else %}#e74c3c{% endif %};">
            {{ daily_stats.success_rate }}%
        </div>
        <div class="progress-bar" style="margin-top: 10px;">
            <div class="progress-fill" style="width: {{ daily_stats.success_rate }}%;"></div>
        </div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å—Ç–∞—Ç—å–∏</div>
        <div class="metric-value" style="font-size: 2rem;">{{ daily_stats.avg_word_count }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">—Å–ª–æ–≤</div>
    </div>
</div>

<!-- –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
<h2 style="margin-top: 40px; margin-bottom: 20px;">‚ú® –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ AI</h2>
<div class="stats-grid">
    <div class="metrics-card">
        <div class="metric-label">–í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π AI</div>
        <div class="metric-value">{{ quality_metrics.total_posts }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
        <div class="metric-value" style="font-size: 2rem;">{{ quality_metrics.avg_views }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">–í—Å–µ–≥–æ: {{ quality_metrics.total_views }}</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">–°—Ä–µ–¥–Ω–∏–µ –ª–∞–π–∫–∏</div>
        <div class="metric-value" style="font-size: 2rem;">{{ quality_metrics.avg_likes }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">–í—Å–µ–≥–æ: {{ quality_metrics.total_likes }}</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">Engagement Rate</div>
        <div class="metric-value" style="font-size: 2rem; color: #9b59b6;">{{ quality_metrics.engagement_rate }}%</div>
        <div style="color: #95a5a6; margin-top: 5px;">–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</div>
    </div>
</div>

<!-- AI vs –ñ–∏–≤—ã–µ –∞–≤—Ç–æ—Ä—ã -->
<h2 style="margin-top: 40px; margin-bottom: 20px;">‚öîÔ∏è AI vs –ñ–∏–≤—ã–µ –∞–≤—Ç–æ—Ä—ã</h2>
<div class="metrics-card">
    <table class="comparison-table">
        <thead>
            <tr>
                <th>–ú–µ—Ç—Ä–∏–∫–∞</th>
                <th style="text-align: center;">ü§ñ AI-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</th>
                <th style="text-align: center;">üë• –ñ–∏–≤—ã–µ –∞–≤—Ç–æ—Ä—ã</th>
                <th style="text-align: center;">–†–∞–∑–Ω–∏—Ü–∞</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π</strong></td>
                <td style="text-align: center;">{{ ai_vs_human.ai.count }}</td>
                <td style="text-align: center;">{{ ai_vs_human.human.count }}</td>
                <td style="text-align: center;">
                    {% if ai_vs_human.ai.count > ai_vs_human.human.count %}
                    <span class="trend-up">+{{ ai_vs_human.ai.count|add:"-"|add:ai_vs_human.human.count }}</span>
                    {% else %}
                    <span class="trend-down">{{ ai_vs_human.ai.count|add:"-"|add:ai_vs_human.human.count }}</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td><strong>–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã</strong></td>
                <td style="text-align: center;">{{ ai_vs_human.ai.avg_views }}</td>
                <td style="text-align: center;">{{ ai_vs_human.human.avg_views }}</td>
                <td style="text-align: center;">
                    {% if ai_vs_human.ai.avg_views > ai_vs_human.human.avg_views %}
                    <span class="trend-up">‚Üë –õ—É—á—à–µ</span>
                    {% else %}
                    <span class="trend-down">‚Üì –•—É–∂–µ</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td><strong>–°—Ä–µ–¥–Ω–∏–µ –ª–∞–π–∫–∏</strong></td>
                <td style="text-align: center;">{{ ai_vs_human.ai.avg_likes }}</td>
                <td style="text-align: center;">{{ ai_vs_human.human.avg_likes }}</td>
                <td style="text-align: center;">
                    {% if ai_vs_human.ai.avg_likes > ai_vs_human.human.avg_likes %}
                    <span class="trend-up">‚Üë –õ—É—á—à–µ</span>
                    {% else %}
                    <span class="trend-down">‚Üì –•—É–∂–µ</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td><strong>–°—Ä–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</strong></td>
                <td style="text-align: center;">{{ ai_vs_human.ai.avg_comments }}</td>
                <td style="text-align: center;">{{ ai_vs_human.human.avg_comments }}</td>
                <td style="text-align: center;">
                    {% if ai_vs_human.ai.avg_comments > ai_vs_human.human.avg_comments %}
                    <span class="trend-up">‚Üë –õ—É—á—à–µ</span>
                    {% else %}
                    <span class="trend-down">‚Üì –•—É–∂–µ</span>
                    {% endif %}
                </td>
            </tr>
            <tr style="background-color: #f8f9fa; font-weight: 600;">
                <td><strong>Engagement Rate</strong></td>
                <td style="text-align: center;">{{ ai_vs_human.ai.engagement_rate }}%</td>
                <td style="text-align: center;">{{ ai_vs_human.human.engagement_rate }}%</td>
                <td style="text-align: center;">
                    {% if ai_vs_human.ai.engagement_rate > ai_vs_human.human.engagement_rate %}
                    <span class="trend-up">‚Üë {{ ai_vs_human.ai.engagement_rate|floatformat:2 }}%</span>
                    {% else %}
                    <span class="trend-down">‚Üì {{ ai_vs_human.ai.engagement_rate|floatformat:2 }}%</span>
                    {% endif %}
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π -->
<h2 style="margin-top: 40px; margin-bottom: 20px;">‚è∞ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</h2>
<div class="metrics-card">
    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
        <div>
            <strong>–í—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:</strong> {{ schedule_performance.total_schedules }}
        </div>
        <div>
            <strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö:</strong> {{ schedule_performance.active_schedules }}
        </div>
    </div>
    
    {% if schedule_performance.best_schedule %}
    <div style="background: #d4edda; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #28a745;">
        <strong>üèÜ –õ—É—á—à–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ schedule_performance.best_schedule.name }}
        (Success Rate: {{ schedule_performance.best_schedule.success_rate }}%)
    </div>
    {% endif %}
    
    <div style="max-height: 400px; overflow-y: auto;">
        {% for schedule in schedule_performance.schedules %}
        <div class="schedule-item">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div>
                    <strong>{{ schedule.name }}</strong>
                    {% if schedule.is_active %}
                    <span class="badge-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                    {% else %}
                    <span class="badge-warning">–ù–µ–∞–∫—Ç–∏–≤–Ω–æ</span>
                    {% endif %}
                </div>
                <div style="text-align: right;">
                    <span style="font-weight: 600;">{{ schedule.success_rate }}%</span>
                    <span style="color: #7f8c8d; font-size: 0.9rem;">Success Rate</span>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; font-size: 0.9rem;">
                <div>
                    <div style="color: #7f8c8d;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
                    <strong>{{ schedule.total_generated }}</strong>
                </div>
                <div>
                    <div style="color: #7f8c8d;">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
                    <strong>{{ schedule.published }}</strong>
                </div>
                <div>
                    <div style="color: #7f8c8d;">–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
                    <strong>{{ schedule.avg_views }}</strong>
                </div>
                <div>
                    <div style="color: #7f8c8d;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                    <strong>{{ schedule.category }}</strong>
                </div>
            </div>
        </div>
        {% empty %}
        <p style="text-align: center; color: #7f8c8d;">–†–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        {% endfor %}
    </div>
</div>

<!-- –ê–Ω–∞–ª–∏–∑ –∑–∞—Ç—Ä–∞—Ç –∏ ROI -->
<h2 style="margin-top: 40px; margin-bottom: 20px;">üí∞ –ê–Ω–∞–ª–∏–∑ –∑–∞—Ç—Ä–∞—Ç –∏ ROI</h2>
<div class="stats-grid">
    <div class="metrics-card">
        <div class="metric-label">–í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π</div>
        <div class="metric-value" style="font-size: 2rem;">{{ cost_analysis.total_articles }}</div>
        <div style="color: #95a5a6; margin-top: 5px;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">–°—Ç–æ–∏–º–æ—Å—Ç—å AI</div>
        <div class="metric-value" style="font-size: 2rem; color: #3498db;">{{ cost_analysis.estimated_cost }} ‚ÇΩ</div>
        <div style="color: #95a5a6; margin-top: 5px;">{{ cost_analysis.cost_per_article }} ‚ÇΩ/—Å—Ç–∞—Ç—å—è</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">–≠–∫–æ–Ω–æ–º–∏—è</div>
        <div class="metric-value" style="font-size: 2rem; color: #27ae60;">{{ cost_analysis.savings }} ‚ÇΩ</div>
        <div style="color: #95a5a6; margin-top: 5px;">vs {{ cost_analysis.author_cost_equivalent }} ‚ÇΩ –∞–≤—Ç–æ—Ä—ã</div>
    </div>
    
    <div class="metrics-card">
        <div class="metric-label">ROI</div>
        <div class="metric-value" style="font-size: 2rem; color: #9b59b6;">{{ cost_analysis.roi }}%</div>
        <div style="color: #95a5a6; margin-top: 5px;">Return on Investment</div>
    </div>
</div>

<div class="metrics-card">
    <h3 style="margin-top: 0;">üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—Ç—Ä–∞—Ç</h3>
    <table class="comparison-table">
        <tr>
            <td><strong>–í—Å–µ–≥–æ API –≤—ã–∑–æ–≤–æ–≤:</strong></td>
            <td>{{ cost_analysis.total_api_calls }}</td>
        </tr>
        <tr>
            <td><strong>–°—Ç–∞—Ç–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π:</strong></td>
            <td>{{ cost_analysis.last_30_days.articles }}</td>
        </tr>
        <tr>
            <td><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ 30 –¥–Ω–µ–π:</strong></td>
            <td>{{ cost_analysis.last_30_days.cost }} ‚ÇΩ</td>
        </tr>
        <tr>
            <td><strong>API –≤—ã–∑–æ–≤–æ–≤ –∑–∞ 30 –¥–Ω–µ–π:</strong></td>
            <td>{{ cost_analysis.last_30_days.api_calls }}</td>
        </tr>
    </table>
</div>

<!-- –¢–æ–ø —Å—Ç–∞—Ç–µ–π -->
<h2 style="margin-top: 40px; margin-bottom: 20px;">üèÜ –¢–æ–ø-10 —Å—Ç–∞—Ç–µ–π</h2>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <div class="metrics-card">
        <h3 style="margin-top: 0;">ü§ñ AI-—Å—Ç–∞—Ç—å–∏</h3>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                    <th style="text-align: center;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                </tr>
            </thead>
            <tbody>
                {% for post in ai_vs_human.top_ai_posts %}
                <tr>
                    <td>
                        <a href="/admin/blog/post/{{ post.id }}/change/" target="_blank">
                            {{ post.title|truncatewords:10 }}
                        </a>
                    </td>
                    <td style="text-align: center;">{{ post.views }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="text-align: center; color: #7f8c8d;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="metrics-card">
        <h3 style="margin-top: 0;">üë• –°—Ç–∞—Ç—å–∏ –∞–≤—Ç–æ—Ä–æ–≤</h3>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                    <th style="text-align: center;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                </tr>
            </thead>
            <tbody>
                {% for post in ai_vs_human.top_human_posts %}
                <tr>
                    <td>
                        <a href="/admin/blog/post/{{ post.id }}/change/" target="_blank">
                            {{ post.title|truncatewords:10 }}
                        </a>
                    </td>
                    <td style="text-align: center;">{{ post.views }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="text-align: center; color: #7f8c8d;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- –§—É—Ç–µ—Ä -->
<div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: center; color: #7f8c8d;">
    <p style="margin: 0;">
        üìä Dashboard –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ | 
        üîó <a href="{% url 'admin:index' %}">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∞–¥–º–∏–Ω–∫—É</a> | 
        üîÑ <a href="?period={{ period_days }}">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</a>
    </p>
</div>

{% endblock %}

