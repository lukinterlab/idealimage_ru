{% extends 'base_tailwind.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Заголовок -->
        <div class="mb-8">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-4xl font-black text-white mb-2">{{ title }}</h1>
                    <p class="text-xl text-gray-300">Подробная информация о задании</p>
                </div>
                <div class="flex gap-3">
                    <a href="{% url 'asistent:tasks_management' %}" 
                       class="px-6 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-md text-white font-semibold rounded-lg transition-colors border border-white/20 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Назад
                    </a>
                    <a href="{% url 'asistent:edit_task' task.id %}" 
                       class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-colors flex items-center gap-2 shadow-lg">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                        </svg>
                        Редактировать
                    </a>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Левая колонка - информация о задании -->
            <div class="space-y-6">
                <!-- Основная информация -->
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 overflow-hidden shadow-2xl">
                    <div class="bg-gradient-to-r from-blue-600 to-cyan-700 px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Информация о задании</h2>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <p class="text-xs text-gray-400 mb-1">Описание:</p>
                            <p class="text-white">{{ task.description }}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Категория:</p>
                                <p class="text-white font-semibold">{{ task.category.title|default:"Не указана" }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Вознаграждение:</p>
                                <p class="text-green-300 font-bold text-lg">{{ task.reward }} ₽</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Слов требуется:</p>
                                <p class="text-white font-semibold">{{ task.required_word_count|default:"Не указано" }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Статус:</p>
                                <span class="px-3 py-1 {% if task.status == 'available' %}bg-green-500/30 text-green-200{% elif task.status == 'active' %}bg-blue-500/30 text-blue-200{% else %}bg-purple-500/30 text-purple-200{% endif %} rounded-full text-sm font-semibold">
                                    {{ task.get_status_display }}
                                </span>
                            </div>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 mb-1">Теги:</p>
                            <p class="text-white">{{ task.tags|default:"Не указаны" }}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Создано:</p>
                                <p class="text-white text-sm">{{ task.created_at|date:"d.m.Y H:i" }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Deadline:</p>
                                <p class="{% if task.is_overdue %}text-red-300{% else %}text-yellow-300{% endif %} font-semibold text-sm">
                                    {{ task.deadline|date:"d.m.Y H:i" }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Назначения -->
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 overflow-hidden shadow-2xl">
                    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Авторы ({{ assignments.count }})</h2>
                    </div>
                    <div class="p-6">
                        {% if assignments %}
                        <div class="space-y-3">
                            {% for assignment in assignments %}
                            <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                                <div class="flex items-center gap-3 flex-1">
                                    <div class="w-10 h-10 bg-purple-500/30 rounded-full flex items-center justify-center">
                                        <span class="text-lg font-bold text-white">{{ assignment.author.username|first|upper }}</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-white">{{ assignment.author.username }}</p>
                                        <p class="text-xs text-gray-400">{{ assignment.get_status_display }} • {{ assignment.taken_at|timesince }} назад</p>
                                    </div>
                                </div>
                                {% if assignment.article %}
                                <a href="/blog/post/{{ assignment.article.slug }}/" target="_blank"
                                   class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs">
                                    Статья →
                                </a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-gray-400 text-center py-4">Никто еще не взял это задание</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Правая колонка - связанные Django-Q задачи -->
            <div>
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 overflow-hidden shadow-2xl">
                    <div class="bg-gradient-to-r from-green-600 to-emerald-700 px-6 py-4">
                        <h2 class="text-xl font-bold text-white flex items-center gap-2">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
                            </svg>
                            Связанные Django-Q задачи
                        </h2>
                    </div>
                    <div class="p-6">
                        {% if related_djangoq_tasks %}
                        <div class="space-y-3">
                            {% for dq_task in related_djangoq_tasks %}
                            <div class="p-4 bg-white/5 rounded-lg hover:bg-white/10 transition-colors">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex-1">
                                        <p class="font-semibold text-white">{{ dq_task.name|default:"Unnamed task" }}</p>
                                        <code class="text-xs text-gray-400 font-mono">{{ dq_task.func }}</code>
                                    </div>
                                    {% if dq_task.stopped %}
                                    <span class="px-2 py-1 bg-green-500/30 text-green-200 rounded text-xs">Выполнена</span>
                                    {% else %}
                                    <span class="px-2 py-1 bg-yellow-500/30 text-yellow-200 rounded text-xs">В очереди</span>
                                    {% endif %}
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-xs text-gray-400">
                                        {% if dq_task.stopped %}
                                        {{ dq_task.stopped|timesince }} назад
                                        {% else %}
                                        Ожидает выполнения
                                        {% endif %}
                                    </span>
                                    <a href="{% url 'asistent:djangoq_task_detail' dq_task.id 'all' %}" 
                                       class="text-blue-400 hover:text-blue-300 text-xs">
                                        Детали →
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-gray-400 text-center py-4">
                            Нет связанных Django-Q задач
                            <br>
                            <span class="text-xs">(AI задачи с упоминанием названия задания)</span>
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
        </div>
        
    </div>
</div>
{% endblock %}

