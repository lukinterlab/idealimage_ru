<!-- GigaChat Mini Widget - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–ª–∞–Ω—Å–∞ -->
<div id="gigachat-mini-widget" class="fixed bottom-4 right-4 z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-3 min-w-[240px]">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π) -->
        <a href="{% url 'asistent:admin_dashboard' %}" class="flex items-center justify-between mb-2 hover:opacity-80 transition-opacity">
            <h4 class="text-sm font-bold text-gray-800 dark:text-white flex items-center gap-2">
                <span class="text-lg">ü§ñ</span>
                GigaChat
            </h4>
            <span class="text-xs text-gray-500">üìä</span>
        </a>
        
        <!-- –ú–∏–Ω–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
        <div class="space-y-2">
            {% if gigachat_mini_stats %}
                {% for model in gigachat_mini_stats.models %}
                <div class="flex items-center justify-between text-xs">
                    <span class="text-gray-600 dark:text-gray-400">{{ model.name_short }}</span>
                    <div class="flex items-center gap-2">
                        <span class="{% if model.status == 'good' %}text-green-500{% elif model.status == 'warning' %}text-yellow-500{% else %}text-red-500{% endif %} font-medium">
                            {{ model.percent }}%
                        </span>
                        <span>{{ model.status_icon }}</span>
                    </div>
                </div>
                {% endfor %}
                
                <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è -->
                {% if gigachat_mini_stats.cost_today %}
                <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-700 flex justify-between">
                    <span class="text-gray-600 dark:text-gray-400">–°–µ–≥–æ–¥–Ω—è:</span>
                    <span class="text-purple-600 dark:text-purple-400 font-medium">{{ gigachat_mini_stats.cost_today }} ‚ÇΩ</span>
                </div>
                {% endif %}
            {% else %}
                <!-- –ó–∞–≥–ª—É—à–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ -->
                <div class="text-center text-xs text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            {% endif %}
        </div>
        
        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ Dashboard -->
        <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-700">
            <a href="{% url 'asistent:admin_dashboard' %}" 
               class="text-xs text-blue-600 dark:text-blue-400 hover:underline flex items-center justify-center gap-1">
                –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Üí
            </a>
        </div>
    </div>
</div>

<!-- Auto-refresh —Å–∫—Ä–∏–ø—Ç -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
    
    function refreshWidget() {
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∂–µ—Ç —á–µ—Ä–µ–∑ AJAX
        fetch(window.location.href, {
            headers: {'X-Requested-With': 'XMLHttpRequest'}
        })
        .then(response => response.text())
        .then(html => {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newWidget = doc.querySelector('#gigachat-mini-widget');
            
            if (newWidget) {
                const currentWidget = document.querySelector('#gigachat-mini-widget');
                if (currentWidget) {
                    currentWidget.innerHTML = newWidget.innerHTML;
                }
            }
        })
        .catch(error => console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', error));
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    setInterval(refreshWidget, REFRESH_INTERVAL);
});
</script>

