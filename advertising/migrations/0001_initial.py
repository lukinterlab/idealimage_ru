# Generated by Django 5.1 on 2025-10-16 21:06

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('blog', '0022_add_performance_indexes'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AdPlace',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Название места')),
                ('code', models.SlugField(help_text='Уникальный идентификатор: header_banner, sidebar_top и т.д.', max_length=100, unique=True, verbose_name='Код места')),
                ('description', models.TextField(blank=True, verbose_name='Описание')),
                ('placement_type', models.CharField(choices=[('banner', 'Баннер'), ('context', 'Контекстная реклама'), ('ticker', 'Бегущая строка'), ('popup', 'Всплывающее окно'), ('overlay', 'Наложение')], default='banner', max_length=20, verbose_name='Тип размещения')),
                ('recommended_size', models.CharField(blank=True, help_text='Например: 728x90, 300x250', max_length=50, verbose_name='Рекомендуемый размер')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активно')),
                ('position_order', models.IntegerField(default=0, help_text='Чем меньше число, тем выше в списке', verbose_name='Порядок показа')),
                ('max_ads_per_rotation', models.IntegerField(default=1, validators=[django.core.validators.MinValueValidator(1)], verbose_name='Максимум объявлений в ротации')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата создания')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Дата обновления')),
            ],
            options={
                'verbose_name': 'Рекламное место',
                'verbose_name_plural': 'Рекламные места',
                'db_table': 'advertising_ad_place',
                'ordering': ['position_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='Advertiser',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Название компании')),
                ('contact_email', models.EmailField(max_length=254, verbose_name='Email для связи')),
                ('contact_phone', models.CharField(blank=True, max_length=50, verbose_name='Телефон')),
                ('company_info', models.TextField(blank=True, verbose_name='Информация о компании')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активен')),
                ('total_spent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Автоматически рассчитывается', max_digits=12, verbose_name='Общая потраченная сумма')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата регистрации')),
            ],
            options={
                'verbose_name': 'Рекламодатель',
                'verbose_name_plural': 'Рекламодатели',
                'db_table': 'advertising_advertiser',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AdCampaign',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Название кампании')),
                ('budget', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Бюджет')),
                ('spent_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Автоматически рассчитывается', max_digits=12, verbose_name='Потрачено')),
                ('cost_per_click', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Стоимость за клик (CPC)')),
                ('cost_per_impression', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Стоимость за 1000 показов (CPM)')),
                ('start_date', models.DateField(verbose_name='Дата начала')),
                ('end_date', models.DateField(verbose_name='Дата окончания')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активна')),
                ('target_audience', models.JSONField(blank=True, default=dict, help_text='JSON с параметрами таргетинга', verbose_name='Целевая аудитория')),
                ('notes', models.TextField(blank=True, verbose_name='Заметки')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата создания')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Дата обновления')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_campaigns', to=settings.AUTH_USER_MODEL, verbose_name='Создал')),
                ('advertiser', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='campaigns', to='advertising.advertiser', verbose_name='Рекламодатель')),
            ],
            options={
                'verbose_name': 'Рекламная кампания',
                'verbose_name_plural': 'Рекламные кампании',
                'db_table': 'advertising_campaign',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AdBanner',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Название баннера')),
                ('banner_type', models.CharField(choices=[('image', 'Изображение'), ('video', 'Видео'), ('html', 'HTML'), ('animated', 'Анимированный')], default='image', max_length=20, verbose_name='Тип баннера')),
                ('image', models.ImageField(blank=True, null=True, upload_to='advertising/banners/', verbose_name='Изображение')),
                ('video', models.FileField(blank=True, null=True, upload_to='advertising/videos/', verbose_name='Видео')),
                ('html_content', models.TextField(blank=True, help_text='Для баннеров типа HTML', verbose_name='HTML контент')),
                ('target_url', models.URLField(help_text='Куда перейдет пользователь при клике', verbose_name='Целевой URL')),
                ('alt_text', models.CharField(blank=True, max_length=200, verbose_name='Альтернативный текст')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активен')),
                ('priority', models.IntegerField(default=5, help_text='От 1 (низкий) до 10 (высокий)', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)], verbose_name='Приоритет')),
                ('weight', models.IntegerField(default=100, help_text='Для A/B тестирования. Чем больше, тем чаще показывается', validators=[django.core.validators.MinValueValidator(1)], verbose_name='Вес в ротации')),
                ('impressions', models.IntegerField(default=0, verbose_name='Показов')),
                ('clicks', models.IntegerField(default=0, verbose_name='Кликов')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата создания')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Дата обновления')),
                ('campaign', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='banners', to='advertising.adcampaign', verbose_name='Кампания')),
                ('place', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='banners', to='advertising.adplace', verbose_name='Место размещения')),
            ],
            options={
                'verbose_name': 'Баннер',
                'verbose_name_plural': 'Баннеры',
                'db_table': 'advertising_banner',
                'ordering': ['-priority', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AdRecommendation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('recommended_for', models.CharField(choices=[('banner', 'Баннер'), ('context', 'Контекстная реклама')], max_length=20, verbose_name='Для чего')),
                ('confidence_score', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Уверенность AI (%)')),
                ('predicted_ctr', models.DecimalField(decimal_places=2, max_digits=5, verbose_name='Предсказанный CTR (%)')),
                ('predicted_revenue', models.DecimalField(decimal_places=2, max_digits=12, verbose_name='Предсказанный доход')),
                ('recommendation_reason', models.TextField(verbose_name='Причина рекомендации')),
                ('is_applied', models.BooleanField(default=False, verbose_name='Применена')),
                ('actual_ctr', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Фактический CTR (%)')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата создания')),
                ('applied_at', models.DateTimeField(blank=True, null=True, verbose_name='Дата применения')),
                ('campaign', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recommendations', to='advertising.adcampaign', verbose_name='Кампания')),
                ('place', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='recommendations', to='advertising.adplace', verbose_name='Место размещения')),
                ('post', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='ad_recommendations', to='blog.post', verbose_name='Статья')),
            ],
            options={
                'verbose_name': 'Рекомендация AI',
                'verbose_name_plural': 'Рекомендации AI',
                'db_table': 'advertising_recommendation',
                'ordering': ['-confidence_score', '-predicted_revenue'],
            },
        ),
        migrations.CreateModel(
            name='AdSchedule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('day_of_week', models.IntegerField(blank=True, choices=[(0, 'Понедельник'), (1, 'Вторник'), (2, 'Среда'), (3, 'Четверг'), (4, 'Пятница'), (5, 'Суббота'), (6, 'Воскресенье')], help_text='Оставьте пустым для показа каждый день', null=True, verbose_name='День недели')),
                ('start_time', models.TimeField(verbose_name='Время начала показа')),
                ('end_time', models.TimeField(verbose_name='Время окончания показа')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активно')),
                ('max_impressions_per_day', models.IntegerField(blank=True, help_text='Оставьте пустым для неограниченных показов', null=True, validators=[django.core.validators.MinValueValidator(1)], verbose_name='Лимит показов в день')),
                ('current_impressions', models.IntegerField(default=0, verbose_name='Текущие показы за день')),
                ('last_reset_date', models.DateField(blank=True, null=True, verbose_name='Дата последнего сброса')),
                ('banner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schedules', to='advertising.adbanner', verbose_name='Баннер')),
            ],
            options={
                'verbose_name': 'Расписание показа',
                'verbose_name_plural': 'Расписания показа',
                'db_table': 'advertising_schedule',
                'ordering': ['banner', 'day_of_week', 'start_time'],
            },
        ),
        migrations.CreateModel(
            name='ContextAd',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('keyword_phrase', models.CharField(help_text='Фраза для поиска в тексте статей', max_length=200, verbose_name='Ключевая фраза')),
                ('anchor_text', models.CharField(help_text='Текст, который будет отображаться как ссылка', max_length=200, verbose_name='Текст ссылки')),
                ('target_url', models.URLField(verbose_name='Целевой URL')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активно')),
                ('insertion_type', models.CharField(choices=[('permanent', 'Постоянная'), ('temporary', 'Временная')], default='permanent', max_length=20, verbose_name='Тип вставки')),
                ('expire_date', models.DateField(blank=True, help_text='Для временных вставок', null=True, verbose_name='Дата истечения')),
                ('cost_per_click', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Стоимость за клик')),
                ('priority', models.IntegerField(default=5, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)], verbose_name='Приоритет')),
                ('max_insertions_per_article', models.IntegerField(default=1, validators=[django.core.validators.MinValueValidator(1)], verbose_name='Макс. вставок в одной статье')),
                ('clicks', models.IntegerField(default=0, verbose_name='Кликов')),
                ('impressions', models.IntegerField(default=0, verbose_name='Показов')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата создания')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Дата обновления')),
                ('campaign', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='context_ads', to='advertising.adcampaign', verbose_name='Кампания')),
            ],
            options={
                'verbose_name': 'Контекстная реклама',
                'verbose_name_plural': 'Контекстная реклама',
                'db_table': 'advertising_context_ad',
                'ordering': ['-priority', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AdInsertion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('inserted_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата вставки')),
                ('inserted_by', models.CharField(help_text='Имя пользователя или "AI"', max_length=100, verbose_name='Кто вставил')),
                ('insertion_position', models.IntegerField(help_text='Номер параграфа или позиция символа', verbose_name='Позиция в тексте')),
                ('anchor_text_used', models.CharField(max_length=200, verbose_name='Использованный текст')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активна')),
                ('clicks', models.IntegerField(default=0, verbose_name='Кликов по этой вставке')),
                ('views', models.IntegerField(default=0, verbose_name='Показов')),
                ('removed_at', models.DateTimeField(blank=True, null=True, verbose_name='Дата удаления')),
                ('removal_reason', models.CharField(blank=True, max_length=200, verbose_name='Причина удаления')),
                ('post', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ad_insertions', to='blog.post', verbose_name='Статья')),
                ('context_ad', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='insertions', to='advertising.contextad', verbose_name='Контекстная реклама')),
            ],
            options={
                'verbose_name': 'Вставка рекламы',
                'verbose_name_plural': 'Вставки рекламы',
                'db_table': 'advertising_insertion',
                'ordering': ['-inserted_at'],
            },
        ),
        migrations.CreateModel(
            name='AdPerformanceML',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(db_index=True, verbose_name='Дата')),
                ('hour', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(23)], verbose_name='Час')),
                ('day_of_week', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(6)], verbose_name='День недели')),
                ('impressions', models.IntegerField(default=0, verbose_name='Показы')),
                ('clicks', models.IntegerField(default=0, verbose_name='Клики')),
                ('ctr', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='CTR (%)')),
                ('revenue', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Доход')),
                ('category', models.CharField(blank=True, max_length=100, verbose_name='Категория статьи')),
                ('device_type', models.CharField(choices=[('desktop', 'Desktop'), ('mobile', 'Mobile'), ('tablet', 'Tablet')], default='desktop', max_length=10, verbose_name='Тип устройства')),
                ('user_type', models.CharField(choices=[('guest', 'Гость'), ('registered', 'Зарегистрирован'), ('author', 'Автор')], default='guest', max_length=20, verbose_name='Тип пользователя')),
                ('effectiveness_score', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Оценка эффективности')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Создано')),
                ('banner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='ml_records', to='advertising.adbanner', verbose_name='Баннер')),
                ('ad_place', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ml_records', to='advertising.adplace', verbose_name='Место размещения')),
                ('context_ad', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='ml_records', to='advertising.contextad', verbose_name='Контекстная реклама')),
            ],
            options={
                'verbose_name': 'Данные ML',
                'verbose_name_plural': 'Данные для ML',
                'db_table': 'advertising_ml_performance',
                'ordering': ['-date', '-hour'],
                'indexes': [models.Index(fields=['date', 'hour'], name='advertising_date_026076_idx'), models.Index(fields=['ad_place', 'date'], name='advertising_ad_plac_7ddb18_idx')],
            },
        ),
        migrations.CreateModel(
            name='AdImpression',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('session_key', models.CharField(blank=True, max_length=100, verbose_name='Ключ сессии')),
                ('ip_address', models.GenericIPAddressField(verbose_name='IP адрес')),
                ('user_agent', models.TextField(blank=True, verbose_name='User Agent')),
                ('shown_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='Дата показа')),
                ('viewport_position', models.CharField(blank=True, choices=[('top', 'Вверху'), ('middle', 'В середине'), ('bottom', 'Внизу')], max_length=10, verbose_name='Позиция во viewport')),
                ('time_visible', models.IntegerField(default=0, verbose_name='Время видимости (сек)')),
                ('ad_banner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='impression_records', to='advertising.adbanner', verbose_name='Баннер')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='Пользователь')),
                ('ad_insertion', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='impression_records', to='advertising.adinsertion', verbose_name='Вставка')),
                ('context_ad', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='impression_records', to='advertising.contextad', verbose_name='Контекстная реклама')),
            ],
            options={
                'verbose_name': 'Показ рекламы',
                'verbose_name_plural': 'Показы рекламы',
                'db_table': 'advertising_impression',
                'ordering': ['-shown_at'],
                'indexes': [models.Index(fields=['-shown_at'], name='advertising_shown_a_79146d_idx'), models.Index(fields=['ip_address', '-shown_at'], name='advertising_ip_addr_ef44cd_idx')],
            },
        ),
        migrations.CreateModel(
            name='AdClick',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('session_key', models.CharField(blank=True, max_length=100, verbose_name='Ключ сессии')),
                ('ip_address', models.GenericIPAddressField(verbose_name='IP адрес')),
                ('user_agent', models.TextField(blank=True, verbose_name='User Agent')),
                ('clicked_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='Дата клика')),
                ('referer', models.URLField(blank=True, verbose_name='Откуда пришел')),
                ('redirect_url', models.URLField(verbose_name='Куда перешел')),
                ('ad_banner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='click_records', to='advertising.adbanner', verbose_name='Баннер')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='Пользователь')),
                ('ad_insertion', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='click_records', to='advertising.adinsertion', verbose_name='Вставка')),
                ('context_ad', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='click_records', to='advertising.contextad', verbose_name='Контекстная реклама')),
            ],
            options={
                'verbose_name': 'Клик по рекламе',
                'verbose_name_plural': 'Клики по рекламе',
                'db_table': 'advertising_click',
                'ordering': ['-clicked_at'],
                'indexes': [models.Index(fields=['-clicked_at'], name='advertising_clicked_b36034_idx'), models.Index(fields=['ip_address', '-clicked_at'], name='advertising_ip_addr_256043_idx')],
            },
        ),
    ]
